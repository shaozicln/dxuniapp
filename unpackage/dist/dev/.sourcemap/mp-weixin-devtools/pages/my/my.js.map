{"version":3,"names":["_regeneratorRuntime2","require","_asyncToGenerator2","common_vendor","common_assets","utils_my_userInfoManager","utils_my_messageHandler","utils_my_navigationService","utils_my_errorHandler","_sfc_main","__name","setup","__props","userInfo","reactive","avatar","name","identity","gender","college","className","major","studentID","teacherID","department","userRole","computed","userInfoManager","getValidIdentity","unreadMsgCount","messageHandler","getUnreadCount","messageList","value","ref","id","title","content","unread","refreshUserInfo","_ref","mark","_callee","initSuccess","wrap","_callee$","_context","prev","next","initUserInfo","sent","index","__f__","t0","errorHandler","handleUserInitError","navigationService","goToLogin","stop","apply","arguments","onMounted","_callee2","_callee2$","_context2","onShow","_callee3","_callee3$","_context3","$on","_callee4","_callee4$","_context4","onUnload","$off","handleAvatarError","e","handleItemTap","item","cancelUnread","deleteMessage","_ref5","_callee5","_callee5$","_context5","_x","handleLongPress","goToProfile","_ref6","_callee6","_callee6$","_context6","goToProfileEdit","_ctx","_cache","a","b","o","c","t","d","f","g","h","length","i","_imports_0$1","j","i0","$event","concat","MiniProgramPage","_export_sfc","wx","createPage"],"sources":["pages/my/my.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../../common/vendor.js\");\nconst common_assets = require(\"../../common/assets.js\");\nconst utils_my_userInfoManager = require(\"../../utils/my/userInfoManager.js\");\nconst utils_my_messageHandler = require(\"../../utils/my/messageHandler.js\");\nconst utils_my_navigationService = require(\"../../utils/my/navigationService.js\");\nconst utils_my_errorHandler = require(\"../../utils/my/errorHandler.js\");\nconst _sfc_main = {\n  __name: \"my\",\n  setup(__props) {\n    const userInfo = common_vendor.reactive({\n      avatar: \"/static/default-avatar.png\",\n      name: \"未设置\",\n      identity: \"未登录\",\n      // 身份标识：领导/督导/老师/学生/未登录\n      gender: \"未设置\",\n      college: \"未设置\",\n      className: \"未设置\",\n      major: \"未设置\",\n      studentID: \"未设置\",\n      teacherID: \"未设置\",\n      department: \"未设置\"\n    });\n    const userRole = common_vendor.computed(() => {\n      return utils_my_userInfoManager.userInfoManager.getValidIdentity(userInfo.identity);\n    });\n    const unreadMsgCount = common_vendor.computed(() => {\n      return utils_my_messageHandler.messageHandler.getUnreadCount(messageList.value);\n    });\n    const messageList = common_vendor.ref([\n      { id: 1, title: \"系统通知\", content: \"新系统通知已送达\", unread: true },\n      { id: 2, title: \"互动消息\", content: \"有学生提交了反馈\", unread: true },\n      { id: 3, title: \"待办提醒\", content: \"请及时完善个人信息\", unread: true }\n    ]);\n    const refreshUserInfo = async () => {\n      try {\n        const initSuccess = await utils_my_userInfoManager.userInfoManager.initUserInfo(userInfo);\n        if (!initSuccess) {\n          common_vendor.index.__f__(\"warn\", \"at pages/my/my.vue:117\", \"用户信息刷新失败，使用默认值\");\n          userInfo.identity = \"未登录\";\n        }\n      } catch (err) {\n        utils_my_errorHandler.errorHandler.handleUserInitError(\n          userInfo,\n          err,\n          () => utils_my_navigationService.navigationService.goToLogin()\n        );\n      }\n    };\n    common_vendor.onMounted(async () => {\n      await refreshUserInfo();\n    });\n    onShow(async () => {\n      await refreshUserInfo();\n    });\n    common_vendor.onMounted(() => {\n      common_vendor.index.$on(\"loginSuccess\", async () => {\n        common_vendor.index.__f__(\"log\", \"at pages/my/my.vue:143\", \"收到登录成功事件，刷新用户信息\");\n        await refreshUserInfo();\n      });\n    });\n    onUnload(() => {\n      common_vendor.index.$off(\"loginSuccess\");\n    });\n    const handleAvatarError = (e) => {\n      utils_my_errorHandler.errorHandler.handleAvatarError(e);\n    };\n    const handleItemTap = (item, index) => {\n      utils_my_messageHandler.messageHandler.handleItemTap(messageList.value, item, index);\n    };\n    const cancelUnread = (index) => {\n      utils_my_messageHandler.messageHandler.cancelUnread(messageList.value, index);\n    };\n    const deleteMessage = async (index) => {\n      await utils_my_messageHandler.messageHandler.deleteMessage(messageList.value, index);\n    };\n    const handleLongPress = (item, index) => {\n      utils_my_messageHandler.messageHandler.handleLongPress(messageList.value, item, index);\n    };\n    const goToProfile = async () => {\n      await utils_my_navigationService.navigationService.goToProfileEdit(\n        userRole.value,\n        userInfo,\n        []\n        // 如需排除敏感字段，在此添加，例如['token']\n      );\n    };\n    return (_ctx, _cache) => {\n      return common_vendor.e({\n        a: userInfo.avatar,\n        b: common_vendor.o(handleAvatarError),\n        c: common_vendor.t(userInfo.name || \"未设置昵称\"),\n        d: common_vendor.t(userRole.value || \"未登录\"),\n        e: common_vendor.o(goToProfile),\n        f: unreadMsgCount.value > 0\n      }, unreadMsgCount.value > 0 ? {\n        g: common_vendor.t(unreadMsgCount.value)\n      } : {}, {\n        h: messageList.value.length === 0\n      }, messageList.value.length === 0 ? {\n        i: common_assets._imports_0$1\n      } : {}, {\n        j: common_vendor.f(messageList.value, (item, index, i0) => {\n          return common_vendor.e({\n            a: item.unread\n          }, item.unread ? {} : {}, {\n            b: common_vendor.t(item.title || \"无标题消息\"),\n            c: common_vendor.t(item.content || \"无内容\"),\n            d: item.unread\n          }, item.unread ? {\n            e: common_vendor.o(($event) => cancelUnread(index), `msg-${item.id}`),\n            f: common_vendor.o(($event) => deleteMessage(index), `msg-${item.id}`)\n          } : {}, {\n            g: item.unread ? 1 : \"\",\n            h: common_vendor.o(($event) => handleItemTap(item, index), `msg-${item.id}`),\n            i: common_vendor.o(($event) => handleLongPress(item, index), `msg-${item.id}`),\n            j: `msg-${item.id}`\n          });\n        })\n      });\n    };\n  }\n};\nconst MiniProgramPage = /* @__PURE__ */ common_vendor._export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-2f1ef635\"]]);\nwx.createPage(MiniProgramPage);\n//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/my/my.js.map\n"],"mappings":"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"}