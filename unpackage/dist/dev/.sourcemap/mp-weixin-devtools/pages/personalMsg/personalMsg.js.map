{"version":3,"names":["common_vendor","require","utils_userInfoUtil_userInfoUtil","utils_logoutUtil_logoutUtil","utils_storage_storage","_sfc_main","__name","setup","__props","userInfo","reactive","avatar","name","identity","gender","college","className","major","studentId","teacherId","infoItems","ref","navigateBack","index","delta","catch","redirectTo","url","handleInfoEdit","item","canEdit","editableFields","userInfoUtil","getEditableFields","fieldConfig","find","cfg","label","type","showActionSheet","itemList","options","success","res","field","tapIndex","updateInfoAndStorage","fail","err","__f__","showModal","title","concat","editable","placeholderText","placeholder","value","confirm","content","trim","generateInfoList","storageUtil","saveUserInfo","handleLogout","logoutUtil","doLogout","onMounted","initFromStorage","_ctx","_cache","a","o","b","c","f","i0","e","t","d","n","$event","MiniProgramPage","_export_sfc","wx","createPage"],"sources":["pages/personalMsg/personalMsg.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../../common/vendor.js\");\nconst utils_userInfoUtil_userInfoUtil = require(\"../../utils/userInfoUtil/userInfoUtil.js\");\nconst utils_logoutUtil_logoutUtil = require(\"../../utils/logoutUtil/logoutUtil.js\");\nconst utils_storage_storage = require(\"../../utils/storage/storage.js\");\nconst _sfc_main = {\n  __name: \"personalMsg\",\n  setup(__props) {\n    const userInfo = common_vendor.reactive({\n      avatar: \"/static/default-avatar.png\",\n      name: \"未设置\",\n      identity: \"未登录\",\n      gender: \"未设置\",\n      college: \"未设置\",\n      className: \"未设置\",\n      major: \"未设置\",\n      studentId: \"未设置\",\n      teacherId: \"\"\n    });\n    const infoItems = common_vendor.ref([]);\n    const navigateBack = () => {\n      common_vendor.index.navigateBack({ delta: 1 }).catch(() => {\n        common_vendor.index.redirectTo({ url: \"/pages/my/my\" });\n      });\n    };\n    const handleInfoEdit = (item) => {\n      if (!item.canEdit)\n        return;\n      const editableFields = utils_userInfoUtil_userInfoUtil.userInfoUtil.getEditableFields(userInfo.identity);\n      const fieldConfig = editableFields.find((cfg) => cfg.label === item.label);\n      if (!fieldConfig)\n        return;\n      if (fieldConfig.type === \"select\") {\n        common_vendor.index.showActionSheet({\n          itemList: fieldConfig.options,\n          success: (res) => {\n            userInfo[fieldConfig.field] = fieldConfig.options[res.tapIndex];\n            updateInfoAndStorage();\n          },\n          fail: (err) => common_vendor.index.__f__(\"error\", \"at pages/personalMsg/personalMsg.vue:90\", \"编辑失败:\", err)\n        });\n      } else if (fieldConfig.type === \"input\") {\n        common_vendor.index.showModal({\n          title: `修改${item.label}`,\n          editable: true,\n          placeholderText: fieldConfig.placeholder,\n          value: item.value !== \"未设置\" ? item.value : \"\",\n          success: (res) => {\n            if (res.confirm && res.content.trim()) {\n              userInfo[fieldConfig.field] = res.content.trim();\n              updateInfoAndStorage();\n            }\n          },\n          fail: (err) => common_vendor.index.__f__(\"error\", \"at pages/personalMsg/personalMsg.vue:106\", \"编辑失败:\", err)\n        });\n      }\n    };\n    const updateInfoAndStorage = () => {\n      infoItems.value = utils_userInfoUtil_userInfoUtil.userInfoUtil.generateInfoList(userInfo);\n      utils_storage_storage.storageUtil.saveUserInfo(userInfo);\n    };\n    const handleLogout = () => {\n      utils_logoutUtil_logoutUtil.logoutUtil.doLogout();\n    };\n    common_vendor.onMounted(() => {\n      utils_userInfoUtil_userInfoUtil.userInfoUtil.initFromStorage(userInfo);\n      updateInfoAndStorage();\n    });\n    return (_ctx, _cache) => {\n      return {\n        a: common_vendor.o(navigateBack),\n        b: userInfo.avatar,\n        c: common_vendor.f(infoItems.value, (item, index, i0) => {\n          return common_vendor.e({\n            a: common_vendor.t(item.label),\n            b: common_vendor.t(item.value),\n            c: item.canEdit\n          }, item.canEdit ? {} : {}, {\n            d: common_vendor.n({\n              \"editable-item\": item.canEdit\n            }),\n            e: index,\n            f: common_vendor.o(($event) => handleInfoEdit(item), index)\n          });\n        }),\n        d: common_vendor.o(handleLogout)\n      };\n    };\n  }\n};\nconst MiniProgramPage = /* @__PURE__ */ common_vendor._export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b99c0b3f\"]]);\nwx.createPage(MiniProgramPage);\n//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/personalMsg/personalMsg.js.map\n"],"mappings":"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"}