{"version":3,"names":["questionnaire","common_vendor","ref","onMounted","savedQuestionnaires","index","getStorageSync","_questionnaires","loadedData","JSON","parse","newQuestionnaires","map","item","questionnaires","_objectSpread2","splice","apply","length","concat","_toConsumableArray2","setStorageSync","stringify","handleBack","navigateBack","delta","selectOption","questionId","optionId","value","question","questions","find","q","id","type","answer","includes","filter","push","isOptionSelected","submitQuestionnaire","allAnswered","every","showToast","title","icon","showLoading","status","allQuestionnaires","findIndex","structuredClone","hideLoading","setTimeout","resetQuestionnaire","showModal","content","success","res","confirm","forEach","wx","createPage","MiniProgramPage"],"sources":["questionnaire-detail.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcXVlc3Rpb25uYWlyZS9xdWVzdGlvbm5haXJlLWRldGFpbC52dWU"],"sourcesContent":["<template>\n  <view class=\"questionnaire-detail-page\">\n    <!-- 顶部导航栏：添加 questionnaire 存在的判断 -->\n    <view class=\"page-header\" v-if=\"questionnaire\">\n      <view class=\"back-button\" @click=\"handleBack\">\n        <text class=\"back-icon\">←</text>\n      </view>\n      <view class=\"header-title\">{{ questionnaire.title }}</view>\n    </view>\n\n    <!-- 加载中状态：数据未加载时显示 -->\n    <view class=\"loading-state\" v-else>\n      <text>加载中...</text>\n    </view>\n\n    <!-- 问卷内容区域：同样添加判断 -->\n    <view class=\"questionnaire-content\" v-if=\"questionnaire\">\n      <view class=\"question-item\" v-for=\"(question, qIndex) in questionnaire.questions\" :key=\"qIndex\">\n        <!-- 原有内容不变 -->\n        <view class=\"question-number\">{{ qIndex + 1 }}.</view>\n        <view class=\"question-text\">{{ question.text }}</view>\n        <view class=\"question-options\">\n          <view \n            class=\"option-item\" \n            v-for=\"(option, oIndex) in question.options\" \n            :key=\"oIndex\"\n            :class=\"{ selected: isOptionSelected(question.id, option.id) }\"\n            @click=\"selectOption(question.id, option.id)\"\n          >\n            {{ option.text }}\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 底部操作区：添加判断 -->\n    <view class=\"bottom-actions\" v-if=\"questionnaire\">\n      <view \n        class=\"reset-btn\" \n        v-if=\"questionnaire.status === 'completed'\" \n        @click=\"resetQuestionnaire\"\n      >\n        重新填写\n      </view>\n      <button \n        class=\"submit-btn\" \n        v-if=\"questionnaire.status !== 'completed'\" \n        @click=\"submitQuestionnaire\"\n      >\n        提交问卷\n      </button>\n    </view>\n  </view>\n</template>\n\n<script setup>\n// 原有脚本逻辑保持不变\nimport { ref, onMounted } from 'vue';\n\nconst questionnaire = ref(null);\n\nonMounted(() => {\n  const savedQuestionnaires = uni.getStorageSync('questionnaires');\n  if (savedQuestionnaires) {\n    const loadedData = JSON.parse(savedQuestionnaires);\n    const newQuestionnaires = loadedData.map((item, index) => {\n      if (questionnaires[index]) {\n        return { ...questionnaires[index], ...item };\n      }\n      return item;\n    });\n    questionnaires.splice(0, questionnaires.length, ...newQuestionnaires);\n  } else {\n    uni.setStorageSync('questionnaires', JSON.stringify(questionnaires));\n  }\n});\n\nconst handleBack = () => {\n  uni.navigateBack({\n    delta: 1\n  });\n};\n\nconst selectOption = (questionId, optionId) => {\n  if (!questionnaire.value) return;\n  \n  const question = questionnaire.value.questions.find(q => q.id === questionId);\n  if (!question) return;\n  \n  if (question.type === 'single' || question.type === 'rating') {\n    question.answer = optionId;\n  } else if (question.type === 'multiple') {\n    if (!question.answer) {\n      question.answer = [optionId];\n    } else if (question.answer.includes(optionId)) {\n      question.answer = question.answer.filter(id => id !== optionId);\n    } else {\n      question.answer.push(optionId);\n    }\n  }\n};\n\nconst isOptionSelected = (questionId, optionId) => {\n  if (!questionnaire.value) return false;\n  \n  const question = questionnaire.value.questions.find(q => q.id === questionId);\n  if (!question || !question.answer) return false;\n  \n  if (question.type === 'single' || question.type === 'rating') {\n    return question.answer === optionId;\n  } else if (question.type === 'multiple') {\n    return question.answer.includes(optionId);\n  }\n  \n  return false;\n};\n\nconst submitQuestionnaire = () => {\n  if (!questionnaire.value) return;\n\n  const allAnswered = questionnaire.value.questions.every(question => {\n    if (question.type === 'single' || question.type === 'rating') {\n      return question.answer !== null;\n    } else if (question.type === 'multiple') {\n      return question.answer && question.answer.length > 0;\n    }\n    return true;\n  });\n\n  if (!allAnswered) {\n    uni.showToast({\n      title: '请回答所有问题',\n      icon: 'none'\n    });\n    return;\n  }\n\n  uni.showLoading({\n    title: '提交中...'\n  });\n\n  // 先更新内存中的数据\n  questionnaire.value.status = 'completed';\n\n  // 然后更新本地存储\n  const allQuestionnaires = JSON.parse(uni.getStorageSync('questionnaires') || '[]');\n  const index = allQuestionnaires.findIndex(q => q.id === questionnaire.value.id);\n  if (index !== -1) {\n    allQuestionnaires[index] = structuredClone(questionnaire.value); // 使用结构化克隆（或深拷贝）确保数据正确\n    uni.setStorageSync('questionnaires', JSON.stringify(allQuestionnaires));\n  }\n\n  uni.hideLoading();\n  uni.showToast({\n    title: '提交成功',\n    icon: 'success'\n  });\n\n  setTimeout(() => {\n    uni.navigateBack({\n      delta: 1\n    });\n  }, 800);\n};\n\nconst resetQuestionnaire = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定要重新填写这份问卷吗？当前答案将被清空。',\n    success: (res) => {\n      if (res.confirm && questionnaire.value) {\n        // 先更新内存中的数据\n        questionnaire.value.questions.forEach(question => {\n          question.answer = null;\n        });\n        questionnaire.value.status = 'pending';\n\n        // 然后更新本地存储\n        const allQuestionnaires = JSON.parse(uni.getStorageSync('questionnaires') || '[]');\n        const index = allQuestionnaires.findIndex(q => q.id === questionnaire.value.id);\n        if (index !== -1) {\n          allQuestionnaires[index] = structuredClone(questionnaire.value);\n          uni.setStorageSync('questionnaires', JSON.stringify(allQuestionnaires));\n        }\n\n        uni.showToast({\n          title: '已重置问卷，可重新填写',\n          icon: 'none'\n        });\n      }\n    }\n  });\n};\n</script>\n\n<style scoped>\n.questionnaire-detail-page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  font-size: 16px;\n  padding-bottom: 120rpx; /* 预留底部按钮区域 */\n}\n\n/* 页面头部样式优化 */\n.page-header {\n  top: 15px;\r\n  height: 120rpx;\r\n  background-color: #87CEEB;\r\n  display: flex;\r\n  align-items: center; \r\n  justify-content: center; \r\n  padding: 0 30rpx;\r\n  position: relative;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n  margin-bottom: 15px;\n}\n\r\n\r\n\n.back-button {\n  position: absolute;\n  left: 20rpx; \n  top: 40rpx; \n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  background-color: rgba(255, 255, 255, 0.2); \n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10; \n  transition: background-color 0.2s;\n}\n\n.back-button:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.back-icon {\n  color: #fff; \n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n/* 标题样式优化 */\n.header-title {\n  color: #777; \n  font-size: 36rpx;\n  font-weight: 500;\n  flex: 1;\n  text-align: center;\n  margin-left: -100rpx; /* 抵消返回按钮宽度，标题居中 */\n  /* 文字溢出处理 */\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 问卷内容区域 */\n.questionnaire-content {\n  padding: 30rpx;\n}\n\n.question-item {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n  /* 添加顶部内边距，与标题区分 */\n  padding-top: 35rpx;\n}\n\n.question-number {\n  font-size: 28rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 15rpx;\n}\n\n.question-text {\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 20rpx;\n  line-height: 1.6; /* 增加行高，提升阅读体验 */\n}\n\n.question-options {\n  display: flex;\n  flex-direction: column;\n  gap: 15rpx;\n}\n\n.option-item {\n  padding: 25rpx 30rpx;\n  border: 1rpx solid #eaeaea;\n  border-radius: 12rpx;\n  font-size: 26rpx;\n  color: #666;\n  transition: all 0.2s;\n}\n\n.option-item.selected {\n  border-color: #42b983;\n  background-color: #e8f5e9;\n  color: #42b983;\n  /* 选中状态添加左侧标识 */\n  position: relative;\n}\n\n.option-item.selected::before {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 6rpx;\n  height: 100%;\n  background-color: #42b983;\n  border-radius: 3rpx 0 0 3rpx;\n}\n\n.option-item:active {\n  background-color: #f5f5f5;\n}\n\n/* 底部操作区 */\n.bottom-actions {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  padding: 20rpx 30rpx; \n  background-color: #fff;\n  border-top: 1rpx solid #eaeaea;\n  /* 关键：使用 flex 布局让子元素水平居中 */\n  display: flex;\n  justify-content: center; \n  align-items: center;\n  z-index: 99;\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n/* 提交按钮 */\n.submit-btn {\n  background-color: #87CEEB; /* 修改为和顶部一致的蓝色 */\n  color: #fff;\n  border: none;\n  border-radius: 10rpx;\n  width: auto;\r\n  padding: 25rpx 40rpx; /* 调整内边距让按钮更美观 */\r\n  text-align: center;\n  font-size: 30rpx;\n  box-shadow: 0 4rpx 10rpx rgba(135, 206, 235, 0.5); /* 调整阴影颜色与按钮一致 */\n  transition: all 0.2s;\n}\n\n.submit-btn:active {\n  background-color: #76b6d9; /* 点击时颜色变深 */\n  box-shadow: 0 2rpx 5rpx rgba(135, 206, 235, 0.3);\n  transform: scale(0.99);\n}\n\n/* 重填按钮 */\n.reset-btn {\n  width: auto; \n  padding: 25rpx 40rpx; /* 调整内边距让按钮更美观 */\n  text-align: center;\n  color: #87CEEB; \n  border: 1rpx solid #87CEEB;\n  border-radius: 10rpx;\n  font-size: 30rpx;\n  background-color: #fff;\n  transition: all 0.2s;\n}\n\n.reset-btn:active {\n  background-color: #e6f2f7; /* 点击时添加浅色背景 */\n  transform: scale(0.99);\n}\n</style>","import MiniProgramPage from 'D:/Uniapp/dxUniapp/pages/questionnaire/questionnaire-detail.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}