{"version":3,"names":["_regeneratorRuntime2","require","_asyncToGenerator2","common_vendor","src_utils_request_request","Math","checkCourseQnr","_sfc_main","__name","setup","__props","questionnaires","ref","isInitialState","loadQuestionnaires","savedQuestionnaires","index","getStorageSync","loadedData","JSON","parse","value","splice","length","forEach","item","push","setStorageSync","stringify","fetchCourseQuestionnaires","_ref","mark","_callee","courseNo","classSerial","res","formattedData","wrap","_callee$","_context","prev","next","showLoading","title","get","sent","hideLoading","code","data","map","id","questionnaireId","questionnaireName","grade","description","concat","courseName","teacherName","date","Date","toLocaleDateString","status","questions","question","text","name","type","mapQuestionType","scoringTypeId","min","max","step","answer","__f__","showToast","msg","icon","t0","stop","_x","_x2","apply","arguments","typeId","typeMap","onMounted","onShow","currentFilter","filteredQuestionnaires","computed","filter","q","navigateToDetail","questionnaire","navigateTo","url","encodeURIComponent","handleBack","navigateBack","delta","showCheckCourse","handleSelectCourse","_ctx","_cache","e","a","o","b","c","$event","d","f","g","h","i","i0","t","n","j","k","l","m","MiniProgramPage","_export_sfc","wx","createPage"],"sources":["pages/questionnaire/questionnaire.js"],"sourcesContent":["\"use strict\";\nconst common_vendor = require(\"../../common/vendor.js\");\nconst src_utils_request_request = require(\"../../src/utils/request/request.js\");\nif (!Math) {\n  checkCourseQnr();\n}\nconst checkCourseQnr = () => \"./checkCourseQnr2.js\";\nconst _sfc_main = {\n  __name: \"questionnaire\",\n  setup(__props) {\n    const questionnaires = common_vendor.ref([]);\n    const isInitialState = common_vendor.ref(true);\n    const loadQuestionnaires = () => {\n      const savedQuestionnaires = common_vendor.index.getStorageSync(\"questionnaires\");\n      if (savedQuestionnaires) {\n        const loadedData = JSON.parse(savedQuestionnaires);\n        questionnaires.value.splice(0, questionnaires.value.length);\n        loadedData.forEach((item) => {\n          questionnaires.push(item);\n        });\n        isInitialState.value = loadedData.length === 0;\n      } else {\n        common_vendor.index.setStorageSync(\"questionnaires\", JSON.stringify(questionnaires));\n      }\n    };\n    const fetchCourseQuestionnaires = async (courseNo, classSerial) => {\n      try {\n        common_vendor.index.showLoading({\n          title: \"获取问卷中...\"\n        });\n        const res = await src_utils_request_request.get(\"/qnr/getCourseQnrCon\", {\n          courseNo,\n          classSerial\n        });\n        common_vendor.index.hideLoading();\n        if (res.code === 200) {\n          const formattedData = res.data.map((item) => ({\n            id: item.questionnaireId,\n            title: item.questionnaireName,\n            grade: \"课程问卷\",\n            // 可根据实际需求调整\n            description: `课程: ${item.courseName} 教师: ${item.teacherName}`,\n            date: (/* @__PURE__ */ new Date()).toLocaleDateString(),\n            // 使用当前日期或接口返回的日期\n            status: \"pending\",\n            // 默认为未完成状态\n            questions: item.questions.map((question) => ({\n              id: question.id,\n              text: question.name,\n              type: mapQuestionType(question.scoringTypeId),\n              //options: getDefaultOptions(question.scoringTypeId),\n              // 为滑动条和星级设置范围属性\n              min: question.scoringTypeId === 3 ? 0 : question.scoringTypeId === 4 ? 1 : void 0,\n              max: question.scoringTypeId === 3 ? 5 : question.scoringTypeId === 4 ? 10 : void 0,\n              step: question.scoringTypeId === 4 ? 1 : void 0,\n              answer: null\n            }))\n          }));\n          questionnaires.value = formattedData;\n          common_vendor.index.__f__(\"log\", \"at pages/questionnaire/questionnaire.vue:139\", questionnaires.value);\n          common_vendor.index.setStorageSync(\"questionnaires\", JSON.stringify(formattedData));\n          isInitialState.value = false;\n        } else {\n          common_vendor.index.showToast({\n            title: res.msg || \"未找到相关问卷\",\n            icon: \"none\"\n          });\n        }\n      } catch (err) {\n        common_vendor.index.hideLoading();\n        common_vendor.index.__f__(\"error\", \"at pages/questionnaire/questionnaire.vue:153\", \"获取课程问卷失败:\", err);\n        common_vendor.index.showToast({\n          title: \"获取问卷失败，请重试\",\n          icon: \"none\"\n        });\n      }\n    };\n    const mapQuestionType = (typeId) => {\n      const typeMap = {\n        1: \"single\",\n        2: \"multiple\",\n        3: \"rating\",\n        4: \"slider\"\n      };\n      return typeMap[typeId] || \"single\";\n    };\n    common_vendor.onMounted(() => {\n      loadQuestionnaires();\n    });\n    common_vendor.onShow(() => {\n      loadQuestionnaires();\n    });\n    const currentFilter = common_vendor.ref(\"all\");\n    const filteredQuestionnaires = common_vendor.computed(() => {\n      if (currentFilter.value === \"all\") {\n        return questionnaires.value;\n      } else if (currentFilter.value === \"pending\") {\n        return questionnaires.value.filter((q) => q.status === \"pending\");\n      } else {\n        return questionnaires.value.filter((q) => q.status === \"completed\");\n      }\n    });\n    const navigateToDetail = (questionnaire) => {\n      common_vendor.index.navigateTo({\n        url: `/pages/questionnaire/questionnaireDetail?data=${encodeURIComponent(JSON.stringify(questionnaire))}`\n      });\n    };\n    const handleBack = () => {\n      common_vendor.index.navigateBack({\n        delta: 1\n        // 返回上一级页面\n      });\n    };\n    const showCheckCourse = common_vendor.ref(false);\n    const handleSelectCourse = (courseNo, classSerial) => {\n      showCheckCourse.value = false;\n      fetchCourseQuestionnaires(courseNo, classSerial);\n      common_vendor.index.__f__(\"log\", \"at pages/questionnaire/questionnaire.vue:269\", \"选中课程：\", courseNo, classSerial);\n    };\n    return (_ctx, _cache) => {\n      return common_vendor.e({\n        a: common_vendor.o(handleBack),\n        b: currentFilter.value === \"all\" ? 1 : \"\",\n        c: common_vendor.o(($event) => currentFilter.value = \"all\"),\n        d: currentFilter.value === \"pending\" ? 1 : \"\",\n        e: common_vendor.o(($event) => currentFilter.value = \"pending\"),\n        f: currentFilter.value === \"completed\" ? 1 : \"\",\n        g: common_vendor.o(($event) => currentFilter.value = \"completed\"),\n        h: isInitialState.value\n      }, isInitialState.value ? {} : {\n        i: common_vendor.f(filteredQuestionnaires.value, (questionnaire, index, i0) => {\n          return {\n            a: common_vendor.t(questionnaire.title),\n            b: common_vendor.t(questionnaire.status === \"completed\" ? \"已完成\" : \"未完成\"),\n            c: common_vendor.n(questionnaire.status === \"completed\" ? \"status-completed\" : \"status-pending\"),\n            d: common_vendor.t(questionnaire.grade),\n            e: common_vendor.t(questionnaire.date),\n            f: common_vendor.t(questionnaire.description),\n            g: index,\n            h: common_vendor.o(($event) => navigateToDetail(questionnaire), index)\n          };\n        })\n      }, {\n        j: common_vendor.o(($event) => showCheckCourse.value = true),\n        k: showCheckCourse.value\n      }, showCheckCourse.value ? {\n        l: common_vendor.o(($event) => showCheckCourse.value = false),\n        m: common_vendor.o(handleSelectCourse),\n        n: common_vendor.o(() => {\n        }),\n        o: common_vendor.o(($event) => showCheckCourse.value = false)\n      } : {});\n    };\n  }\n};\nconst MiniProgramPage = /* @__PURE__ */ common_vendor._export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-57a88e77\"]]);\nwx.createPage(MiniProgramPage);\n//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/questionnaire/questionnaire.js.map\n"],"mappings":";AAAA,YAAY;;AAAC,IAAAA,oBAAA,GAAAC,OAAA;AAAA,IAAAC,kBAAA,GAAAD,OAAA;AACb,IAAME,aAAa,GAAGF,OAAO,CAAC,wBAAwB,CAAC;AACvD,IAAMG,yBAAyB,GAAGH,OAAO,CAAC,oCAAoC,CAAC;AAC/E,IAAI,CAACI,IAAI,EAAE;EACTC,cAAc,EAAE;AAClB;AACA,IAAMA,cAAc,GAAG,SAAjBA,cAAcA,CAAA;EAAA,OAAS,sBAAsB;AAAA;AACnD,IAAMC,SAAS,GAAG;EAChBC,MAAM,EAAE,eAAe;EACvBC,KAAK,WAAAA,MAACC,OAAO,EAAE;IACb,IAAMC,cAAc,GAAGR,aAAa,CAACS,GAAG,CAAC,EAAE,CAAC;IAC5C,IAAMC,cAAc,GAAGV,aAAa,CAACS,GAAG,CAAC,IAAI,CAAC;IAC9C,IAAME,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAA,EAAS;MAC/B,IAAMC,mBAAmB,GAAGZ,aAAa,CAACa,KAAK,CAACC,cAAc,CAAC,gBAAgB,CAAC;MAChF,IAAIF,mBAAmB,EAAE;QACvB,IAAMG,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACL,mBAAmB,CAAC;QAClDJ,cAAc,CAACU,KAAK,CAACC,MAAM,CAAC,CAAC,EAAEX,cAAc,CAACU,KAAK,CAACE,MAAM,CAAC;QAC3DL,UAAU,CAACM,OAAO,CAAC,UAACC,IAAI,EAAK;UAC3Bd,cAAc,CAACe,IAAI,CAACD,IAAI,CAAC;QAC3B,CAAC,CAAC;QACFZ,cAAc,CAACQ,KAAK,GAAGH,UAAU,CAACK,MAAM,KAAK,CAAC;MAChD,CAAC,MAAM;QACLpB,aAAa,CAACa,KAAK,CAACW,cAAc,CAAC,gBAAgB,EAAER,IAAI,CAACS,SAAS,CAACjB,cAAc,CAAC,CAAC;MACtF;IACF,CAAC;IACD,IAAMkB,yBAAyB;MAAA,IAAAC,IAAA,GAAA5B,kBAAA,eAAAF,oBAAA,GAAA+B,IAAA,CAAG,SAAAC,QAAOC,QAAQ,EAAEC,WAAW;QAAA,IAAAC,GAAA,EAAAC,aAAA;QAAA,OAAApC,oBAAA,GAAAqC,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAE1DrC,aAAa,CAACa,KAAK,CAAC0B,WAAW,CAAC;gBAC9BC,KAAK,EAAE;cACT,CAAC,CAAC;cAACJ,QAAA,CAAAE,IAAA;cAAA,OACerC,yBAAyB,CAACwC,GAAG,CAAC,sBAAsB,EAAE;gBACtEX,QAAQ,EAARA,QAAQ;gBACRC,WAAW,EAAXA;cACF,CAAC,CAAC;YAAA;cAHIC,GAAG,GAAAI,QAAA,CAAAM,IAAA;cAIT1C,aAAa,CAACa,KAAK,CAAC8B,WAAW,EAAE;cACjC,IAAIX,GAAG,CAACY,IAAI,KAAK,GAAG,EAAE;gBACdX,aAAa,GAAGD,GAAG,CAACa,IAAI,CAACC,GAAG,CAAC,UAACxB,IAAI;kBAAA,OAAM;oBAC5CyB,EAAE,EAAEzB,IAAI,CAAC0B,eAAe;oBACxBR,KAAK,EAAElB,IAAI,CAAC2B,iBAAiB;oBAC7BC,KAAK,EAAE,MAAM;oBACb;oBACAC,WAAW,mBAAAC,MAAA,CAAS9B,IAAI,CAAC+B,UAAU,qBAAAD,MAAA,CAAQ9B,IAAI,CAACgC,WAAW,CAAE;oBAC7DC,IAAI,EAAG,eAAgB,IAAIC,IAAI,EAAE,CAAEC,kBAAkB,EAAE;oBACvD;oBACAC,MAAM,EAAE,SAAS;oBACjB;oBACAC,SAAS,EAAErC,IAAI,CAACqC,SAAS,CAACb,GAAG,CAAC,UAACc,QAAQ;sBAAA,OAAM;wBAC3Cb,EAAE,EAAEa,QAAQ,CAACb,EAAE;wBACfc,IAAI,EAAED,QAAQ,CAACE,IAAI;wBACnBC,IAAI,EAAEC,eAAe,CAACJ,QAAQ,CAACK,aAAa,CAAC;wBAC7C;wBACA;wBACAC,GAAG,EAAEN,QAAQ,CAACK,aAAa,KAAK,CAAC,GAAG,CAAC,GAAGL,QAAQ,CAACK,aAAa,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;wBACjFE,GAAG,EAAEP,QAAQ,CAACK,aAAa,KAAK,CAAC,GAAG,CAAC,GAAGL,QAAQ,CAACK,aAAa,KAAK,CAAC,GAAG,EAAE,GAAG,KAAK,CAAC;wBAClFG,IAAI,EAAER,QAAQ,CAACK,aAAa,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;wBAC/CI,MAAM,EAAE;sBACV,CAAC;oBAAA,CAAC;kBACJ,CAAC;gBAAA,CAAC,CAAC;gBACH7D,cAAc,CAACU,KAAK,GAAGe,aAAa;gBACpCjC,aAAa,CAACa,KAAK,CAACyD,KAAK,CAAC,KAAK,EAAE,8CAA8C,EAAE9D,cAAc,CAACU,KAAK,CAAC;gBACtGlB,aAAa,CAACa,KAAK,CAACW,cAAc,CAAC,gBAAgB,EAAER,IAAI,CAACS,SAAS,CAACQ,aAAa,CAAC,CAAC;gBACnFvB,cAAc,CAACQ,KAAK,GAAG,KAAK;cAC9B,CAAC,MAAM;gBACLlB,aAAa,CAACa,KAAK,CAAC0D,SAAS,CAAC;kBAC5B/B,KAAK,EAAER,GAAG,CAACwC,GAAG,IAAI,SAAS;kBAC3BC,IAAI,EAAE;gBACR,CAAC,CAAC;cACJ;cAACrC,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAsC,EAAA,GAAAtC,QAAA;cAEDpC,aAAa,CAACa,KAAK,CAAC8B,WAAW,EAAE;cACjC3C,aAAa,CAACa,KAAK,CAACyD,KAAK,CAAC,OAAO,EAAE,8CAA8C,EAAE,WAAW,EAAAlC,QAAA,CAAAsC,EAAA,CAAM;cACpG1E,aAAa,CAACa,KAAK,CAAC0D,SAAS,CAAC;gBAC5B/B,KAAK,EAAE,YAAY;gBACnBiC,IAAI,EAAE;cACR,CAAC,CAAC;YAAC;YAAA;cAAA,OAAArC,QAAA,CAAAuC,IAAA;UAAA;QAAA,GAAA9C,OAAA;MAAA,CAEN;MAAA,gBAnDKH,yBAAyBA,CAAAkD,EAAA,EAAAC,GAAA;QAAA,OAAAlD,IAAA,CAAAmD,KAAA,OAAAC,SAAA;MAAA;IAAA,GAmD9B;IACD,IAAMf,eAAe,GAAG,SAAlBA,eAAeA,CAAIgB,MAAM,EAAK;MAClC,IAAMC,OAAO,GAAG;QACd,CAAC,EAAE,QAAQ;QACX,CAAC,EAAE,UAAU;QACb,CAAC,EAAE,QAAQ;QACX,CAAC,EAAE;MACL,CAAC;MACD,OAAOA,OAAO,CAACD,MAAM,CAAC,IAAI,QAAQ;IACpC,CAAC;IACDhF,aAAa,CAACkF,SAAS,CAAC,YAAM;MAC5BvE,kBAAkB,EAAE;IACtB,CAAC,CAAC;IACFX,aAAa,CAACmF,MAAM,CAAC,YAAM;MACzBxE,kBAAkB,EAAE;IACtB,CAAC,CAAC;IACF,IAAMyE,aAAa,GAAGpF,aAAa,CAACS,GAAG,CAAC,KAAK,CAAC;IAC9C,IAAM4E,sBAAsB,GAAGrF,aAAa,CAACsF,QAAQ,CAAC,YAAM;MAC1D,IAAIF,aAAa,CAAClE,KAAK,KAAK,KAAK,EAAE;QACjC,OAAOV,cAAc,CAACU,KAAK;MAC7B,CAAC,MAAM,IAAIkE,aAAa,CAAClE,KAAK,KAAK,SAAS,EAAE;QAC5C,OAAOV,cAAc,CAACU,KAAK,CAACqE,MAAM,CAAC,UAACC,CAAC;UAAA,OAAKA,CAAC,CAAC9B,MAAM,KAAK,SAAS;QAAA,EAAC;MACnE,CAAC,MAAM;QACL,OAAOlD,cAAc,CAACU,KAAK,CAACqE,MAAM,CAAC,UAACC,CAAC;UAAA,OAAKA,CAAC,CAAC9B,MAAM,KAAK,WAAW;QAAA,EAAC;MACrE;IACF,CAAC,CAAC;IACF,IAAM+B,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,aAAa,EAAK;MAC1C1F,aAAa,CAACa,KAAK,CAAC8E,UAAU,CAAC;QAC7BC,GAAG,mDAAAxC,MAAA,CAAmDyC,kBAAkB,CAAC7E,IAAI,CAACS,SAAS,CAACiE,aAAa,CAAC,CAAC;MACzG,CAAC,CAAC;IACJ,CAAC;IACD,IAAMI,UAAU,GAAG,SAAbA,UAAUA,CAAA,EAAS;MACvB9F,aAAa,CAACa,KAAK,CAACkF,YAAY,CAAC;QAC/BC,KAAK,EAAE;QACP;MACF,CAAC,CAAC;IACJ,CAAC;;IACD,IAAMC,eAAe,GAAGjG,aAAa,CAACS,GAAG,CAAC,KAAK,CAAC;IAChD,IAAMyF,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAIpE,QAAQ,EAAEC,WAAW,EAAK;MACpDkE,eAAe,CAAC/E,KAAK,GAAG,KAAK;MAC7BQ,yBAAyB,CAACI,QAAQ,EAAEC,WAAW,CAAC;MAChD/B,aAAa,CAACa,KAAK,CAACyD,KAAK,CAAC,KAAK,EAAE,8CAA8C,EAAE,OAAO,EAAExC,QAAQ,EAAEC,WAAW,CAAC;IAClH,CAAC;IACD,OAAO,UAACoE,IAAI,EAAEC,MAAM,EAAK;MACvB,OAAOpG,aAAa,CAACqG,CAAC,CAAC;QACrBC,CAAC,EAAEtG,aAAa,CAACuG,CAAC,CAACT,UAAU,CAAC;QAC9BU,CAAC,EAAEpB,aAAa,CAAClE,KAAK,KAAK,KAAK,GAAG,CAAC,GAAG,EAAE;QACzCuF,CAAC,EAAEzG,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKtB,aAAa,CAAClE,KAAK,GAAG,KAAK;QAAA,EAAC;QAC3DyF,CAAC,EAAEvB,aAAa,CAAClE,KAAK,KAAK,SAAS,GAAG,CAAC,GAAG,EAAE;QAC7CmF,CAAC,EAAErG,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKtB,aAAa,CAAClE,KAAK,GAAG,SAAS;QAAA,EAAC;QAC/D0F,CAAC,EAAExB,aAAa,CAAClE,KAAK,KAAK,WAAW,GAAG,CAAC,GAAG,EAAE;QAC/C2F,CAAC,EAAE7G,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKtB,aAAa,CAAClE,KAAK,GAAG,WAAW;QAAA,EAAC;QACjE4F,CAAC,EAAEpG,cAAc,CAACQ;MACpB,CAAC,EAAER,cAAc,CAACQ,KAAK,GAAG,CAAC,CAAC,GAAG;QAC7B6F,CAAC,EAAE/G,aAAa,CAAC4G,CAAC,CAACvB,sBAAsB,CAACnE,KAAK,EAAE,UAACwE,aAAa,EAAE7E,KAAK,EAAEmG,EAAE,EAAK;UAC7E,OAAO;YACLV,CAAC,EAAEtG,aAAa,CAACiH,CAAC,CAACvB,aAAa,CAAClD,KAAK,CAAC;YACvCgE,CAAC,EAAExG,aAAa,CAACiH,CAAC,CAACvB,aAAa,CAAChC,MAAM,KAAK,WAAW,GAAG,KAAK,GAAG,KAAK,CAAC;YACxE+C,CAAC,EAAEzG,aAAa,CAACkH,CAAC,CAACxB,aAAa,CAAChC,MAAM,KAAK,WAAW,GAAG,kBAAkB,GAAG,gBAAgB,CAAC;YAChGiD,CAAC,EAAE3G,aAAa,CAACiH,CAAC,CAACvB,aAAa,CAACxC,KAAK,CAAC;YACvCmD,CAAC,EAAErG,aAAa,CAACiH,CAAC,CAACvB,aAAa,CAACnC,IAAI,CAAC;YACtCqD,CAAC,EAAE5G,aAAa,CAACiH,CAAC,CAACvB,aAAa,CAACvC,WAAW,CAAC;YAC7C0D,CAAC,EAAEhG,KAAK;YACRiG,CAAC,EAAE9G,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;cAAA,OAAKjB,gBAAgB,CAACC,aAAa,CAAC;YAAA,GAAE7E,KAAK;UACvE,CAAC;QACH,CAAC;MACH,CAAC,EAAE;QACDsG,CAAC,EAAEnH,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKT,eAAe,CAAC/E,KAAK,GAAG,IAAI;QAAA,EAAC;QAC5DkG,CAAC,EAAEnB,eAAe,CAAC/E;MACrB,CAAC,EAAE+E,eAAe,CAAC/E,KAAK,GAAG;QACzBmG,CAAC,EAAErH,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKT,eAAe,CAAC/E,KAAK,GAAG,KAAK;QAAA,EAAC;QAC7DoG,CAAC,EAAEtH,aAAa,CAACuG,CAAC,CAACL,kBAAkB,CAAC;QACtCgB,CAAC,EAAElH,aAAa,CAACuG,CAAC,CAAC,YAAM,CACzB,CAAC,CAAC;QACFA,CAAC,EAAEvG,aAAa,CAACuG,CAAC,CAAC,UAACG,MAAM;UAAA,OAAKT,eAAe,CAAC/E,KAAK,GAAG,KAAK;QAAA;MAC9D,CAAC,GAAG,CAAC,CAAC,CAAC;IACT,CAAC;EACH;AACF,CAAC;AACD,IAAMqG,eAAe,GAAG,eAAgBvH,aAAa,CAACwH,WAAW,CAACpH,SAAS,EAAE,CAAC,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC,CAAC;AAChHqH,EAAE,CAACC,UAAU,CAACH,eAAe,CAAC"}