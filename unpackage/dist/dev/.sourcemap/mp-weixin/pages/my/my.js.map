{"version":3,"file":"my.js","sources":["pages/my/my.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXkvbXkudnVl"],"sourcesContent":["<template>\r\n  <view class=\"my-container\">\r\n    <view class=\"profile-section\" @tap=\"goToProfile\"> \r\n      <image \r\n        class=\"avatar\" \r\n        :src=\"userInfo.avatarUrl\" \r\n        mode=\"aspectFill\"\r\n        lazy-load \r\n      ></image>\r\n      <view class=\"user-info-wrapper\">\r\n        <view class=\"user-info\">\r\n          <text class=\"nickname\">{{ userInfo.name }}</text>\r\n          <text class=\"desc\">用户当前身份为：{{ userRole }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 消息列表区域 -->\r\n    <view class=\"message-section\">\r\n      <view class=\"section-title\">消息列表</view>\r\n      <view v-if=\"messageList.length === 0\" class=\"empty-tip\">暂无消息</view>\r\n      <template v-else v-for=\"(item, index) in messageList\" :key=\"item.id\"> \r\n        <view \r\n          class=\"message-item\" \r\n          :class=\"{ unread: item.unread }\"\r\n          @tap=\"handleItemTap(item)\"\r\n          @longpress=\"handleLongPress(index)\"\r\n        >\r\n          <text class=\"message-title\">{{ item.title }}</text>\r\n          <text class=\"message-content\">{{ item.content }}</text>\r\n          <view class=\"action-buttons\" v-if=\"item.unread\">\r\n            <button \r\n              class=\"btn cancel-unread\" \r\n              size=\"mini\" \r\n              @tap.stop=\"cancelUnread(index)\"\r\n            >\r\n              取消标红\r\n            </button>\r\n            <button \r\n              class=\"btn delete-msg\" \r\n              size=\"mini\" \r\n              @tap.stop=\"deleteMessage(index)\"\r\n            >\r\n              删除\r\n            </button>\r\n          </view>\r\n        </view>\r\n      </template>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n\r\nimport { reactive, onMounted, ref } from 'vue';\r\nimport { navigateToWithLoading } from '../../src/utils/navigate/navigate'; \r\n\r\ninterface UserInfo {\r\n  avatarUrl?: string;\r\n  name: string;\r\n  teacherId?: string;\r\n}\r\n\r\ninterface MessageItem {\r\n  id: number;\r\n  title: string;\r\n  content: string;\r\n  unread: boolean;\r\n}\r\n\r\n// 响应式数据\r\nconst userInfo = reactive<UserInfo>({\r\n  avatarUrl: '/static/default-avatar.png',\r\n  name: '未登录'\r\n});\r\nconst userRole = ref<string>('未登录'); // 存储判断后的身份\r\nconst messageList = reactive<MessageItem[]>([\r\n  { id: 1, title: '系统通知', content: '新系统通知...', unread: true },\r\n  { id: 2, title: '互动消息', content: '学生发来的未读消息', unread: true }, \r\n  { id: 3, title: '测试消息', content: '未读测试', unread: true }\r\n]);\r\n\r\nonMounted(() => {\r\n  try {\r\n    const storedUserInfo = uni.getStorageSync('userInfo') as UserInfo;\r\n\r\n    if (storedUserInfo && storedUserInfo.name) {\r\n      userInfo.name = storedUserInfo.name;\r\n      if (storedUserInfo.avatarUrl) {\r\n        userInfo.avatarUrl = storedUserInfo.avatarUrl;\r\n      }\r\n\r\n      const teacherId = storedUserInfo.teacherId || '';\r\n      userRole.value = teacherId.startsWith('Z') ? '老师' : '学生';\r\n\r\n      uni.__f__('log','at pages/my/my.vue:96','读取本地用户信息成功，身份：', userRole.value);\r\n    } else {\r\n      uni.__f__('warn','at pages/my/my.vue:98','本地用户信息不完整');\r\n      userRole.value = '未登录';\r\n    }\r\n  } catch (err) {\r\n    uni.__f__('error','at pages/my/my.vue:102','读取用户信息失败:', err);\r\n    userRole.value = '身份未知';\r\n  }\r\n});\r\nconst handleItemTap = (item: MessageItem) => {\r\n  uni.__f__('log','at pages/my/my.vue:107','点击消息:', item);\r\n  if (item.unread) {\r\n    const index = messageList.findIndex(msg => msg.id === item.id);\r\n    if (index !== -1) messageList[index].unread = false;\r\n  }\r\n};\r\n\r\nconst cancelUnread = (index: number) => {\r\n  messageList[index].unread = false;\r\n};\r\n\r\nconst deleteMessage = (index: number) => {\r\n  messageList.splice(index, 1);\r\n};\r\n\r\nconst handleLongPress = (index: number) => {\r\n  const currentItem = messageList[index];\r\n  if (currentItem.unread) return; \r\n\r\n  uni.showActionSheet({\r\n    itemList: ['恢复标红', '删除', '取消'],\r\n    success: (res) => {\r\n      if (res.tapIndex === 0) {\r\n        currentItem.unread = true; \r\n      } else if (res.tapIndex === 1) {\r\n        deleteMessage(index);\r\n      }\r\n    },\r\n    fail: (err) => {\r\n      uni.__f__('warn','at pages/my/my.vue:136','长按菜单调用失败:', err);\r\n    }\r\n  });\r\n};\r\n\r\nconst goToProfile = async () => {\r\n  try {\r\n    await navigateToWithLoading('/pages/personalMsg/personalMsg', {\r\n      loadingText: '加载中...',\r\n      onError: (err) => {\r\n        uni.__f__('warn','at pages/my/my.vue:146','跳转异常:', err);\r\n        uni.showToast({ title: '跳转失败', icon: 'none' }); \r\n      }\r\n    });\r\n  } catch (err) {\r\n    uni.__f__('error','at pages/my/my.vue:151','跳转个人信息页失败:', err);\r\n    uni.showToast({ title: '跳转失败', icon: 'none' });\r\n  }\r\n};\r\n</script>\r\n<style scoped>\r\n\r\n.my-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: #f8fef8; \r\n  min-height: 100vh;\r\n}\r\n\r\n/* 个人信息区域 */\r\n.profile-section {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 30vh;\r\n  background: linear-gradient(to bottom, #c9edf5, #f8fef8); \r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  padding: 0 40rpx;\r\n  box-sizing: border-box;\r\n  margin-bottom: 0;\r\n}\r\n\r\n/* 头像样式 */\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 50%;\r\n  border: 3rpx solid #c9edf5; \r\n  margin-right: 20rpx; \r\n  object-fit: cover;\r\n}\r\n\r\n/* 用户信息包裹层 */\r\n.user-info-wrapper {\r\n  flex: 1;\r\n  display: flex;\r\n  justify-content: flex-start; \r\n  align-items: center;\r\n}\r\n\r\n/* 用户信息内容 */\r\n.user-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n/* 昵称样式 */\r\n.nickname {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #444; \r\n  text-align: left; \r\n}\r\n\r\n/* 描述文本样式 */\r\n.desc {\r\n  font-size: 28rpx;\r\n  color: #777; \r\n  margin-top: 8rpx;\r\n  text-align: left;\r\n}\r\n\r\n/* 消息列表区域 */\r\n.message-section {\r\n  flex: 1;\r\n  padding: 20rpx 10rpx;\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* 板块标题样式 */\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n  border-left: 10rpx solid #90ee90; \r\n  padding-left: 10rpx;\r\n}\r\n\r\n/* 空列表提示 */\r\n.empty-tip {\r\n  font-size: 28rpx;\r\n  color: #999;\r\n  text-align: center;\r\n  padding: 50rpx 0;\r\n}\r\n\r\n/* 消息项容器 */\r\n.message-item {\r\n  padding: 20rpx;\r\n  border-bottom: 1px solid #f0f0f0; \r\n  display: flex;\r\n  flex-direction: column;\r\n  transition: background-color 0.2s ease; \r\n  border: 1px solid #e6e6e6; \r\n  border-radius: 8rpx;\r\n  margin-bottom: 15rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n/* 未读消息背景样式 */\r\n.unread {\r\n  background-color: #ffeaea; \r\n  border-color: #ffcccc;\r\n}\r\n\r\n/* 消息标题样式 */\r\n.message-title {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n/* 消息内容样式 */\r\n.message-content {\r\n  font-size: 26rpx;\r\n  color: #666; \r\n  line-height: 1.6; \r\n\r\n  display: -webkit-box;\r\n  -webkit-line-clamp: 2;\r\n  -webkit-box-orient: vertical;\r\n  overflow: hidden;\r\n}\r\n\r\n/* 操作按钮容器 */\r\n.action-buttons {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  margin-top: 15rpx; \r\n}\r\n\r\n/* 按钮基础样式 */\r\n.btn {\r\n  margin-left: 20rpx;\r\n  padding: 12rpx 24rpx; \r\n  border-radius: 8rpx;\r\n  font-size: 24rpx; \r\n  border: none;\r\n}\r\n\r\n/* 取消标红按钮样式 */\r\n.cancel-unread {\r\n  background-color: #70d770; \r\n  color: #fff;\r\n}\r\n\r\n/* 删除按钮样式 */\r\n.delete-msg {\r\n  background-color: #f75757; \r\n  color: #fff;\r\n}\r\n\r\n/* 按钮点击反馈 */\r\n.btn:active {\r\n  opacity: 0.8;\r\n  transform: scale(0.98);\r\n}\r\n</style>","import MiniProgramPage from 'D:/PJ-system/uniapp/pages/my/my.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","onMounted","uni","navigateToWithLoading"],"mappings":";;;;;;AAuEA,UAAM,WAAWA,cAAAA,SAAmB;AAAA,MAClC,WAAW;AAAA,MACX,MAAM;AAAA,IAAA,CACP;AACK,UAAA,WAAWC,kBAAY,KAAK;AAClC,UAAM,cAAcD,cAAAA,SAAwB;AAAA,MAC1C,EAAE,IAAI,GAAG,OAAO,QAAQ,SAAS,YAAY,QAAQ,KAAK;AAAA,MAC1D,EAAE,IAAI,GAAG,OAAO,QAAQ,SAAS,aAAa,QAAQ,KAAK;AAAA,MAC3D,EAAE,IAAI,GAAG,OAAO,QAAQ,SAAS,QAAQ,QAAQ,KAAK;AAAA,IAAA,CACvD;AAEDE,kBAAAA,UAAU,MAAM;AACV,UAAA;AACI,cAAA,iBAAiBC,cAAAA,MAAI,eAAe,UAAU;AAEhD,YAAA,kBAAkB,eAAe,MAAM;AACzC,mBAAS,OAAO,eAAe;AAC/B,cAAI,eAAe,WAAW;AAC5B,qBAAS,YAAY,eAAe;AAAA,UACtC;AAEM,gBAAA,YAAY,eAAe,aAAa;AAC9C,mBAAS,QAAQ,UAAU,WAAW,GAAG,IAAI,OAAO;AAEpDA,wBAAA,MAAI,MAAM,OAAM,yBAAwB,kBAAkB,SAAS,KAAK;AAAA,QAAA,OACnE;AACDA,wBAAAA,MAAA,MAAM,QAAO,yBAAwB,WAAW;AACpD,mBAAS,QAAQ;AAAA,QACnB;AAAA,eACO,KAAK;AACZA,sBAAA,MAAI,MAAM,SAAQ,0BAAyB,aAAa,GAAG;AAC3D,iBAAS,QAAQ;AAAA,MACnB;AAAA,IAAA,CACD;AACK,UAAA,gBAAgB,CAAC,SAAsB;AAC3CA,oBAAA,MAAI,MAAM,OAAM,0BAAyB,SAAS,IAAI;AACtD,UAAI,KAAK,QAAQ;AACf,cAAM,QAAQ,YAAY,UAAU,SAAO,IAAI,OAAO,KAAK,EAAE;AAC7D,YAAI,UAAU;AAAgB,sBAAA,KAAK,EAAE,SAAS;AAAA,MAChD;AAAA,IAAA;AAGI,UAAA,eAAe,CAAC,UAAkB;AAC1B,kBAAA,KAAK,EAAE,SAAS;AAAA,IAAA;AAGxB,UAAA,gBAAgB,CAAC,UAAkB;AAC3B,kBAAA,OAAO,OAAO,CAAC;AAAA,IAAA;AAGvB,UAAA,kBAAkB,CAAC,UAAkB;AACnC,YAAA,cAAc,YAAY,KAAK;AACrC,UAAI,YAAY;AAAQ;AAExBA,oBAAAA,MAAI,gBAAgB;AAAA,QAClB,UAAU,CAAC,QAAQ,MAAM,IAAI;AAAA,QAC7B,SAAS,CAAC,QAAQ;AACZ,cAAA,IAAI,aAAa,GAAG;AACtB,wBAAY,SAAS;AAAA,UAAA,WACZ,IAAI,aAAa,GAAG;AAC7B,0BAAc,KAAK;AAAA,UACrB;AAAA,QACF;AAAA,QACA,MAAM,CAAC,QAAQ;AACbA,wBAAA,MAAI,MAAM,QAAO,0BAAyB,aAAa,GAAG;AAAA,QAC5D;AAAA,MAAA,CACD;AAAA,IAAA;AAGH,UAAM,cAAc,YAAY;AAC1B,UAAA;AACF,cAAMC,4BAAAA,sBAAsB,kCAAkC;AAAA,UAC5D,aAAa;AAAA,UACb,SAAS,CAAC,QAAQ;AAChBD,0BAAA,MAAI,MAAM,QAAO,0BAAyB,SAAS,GAAG;AACtDA,0BAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,UAC/C;AAAA,QAAA,CACD;AAAA,eACM,KAAK;AACZA,sBAAA,MAAI,MAAM,SAAQ,0BAAyB,cAAc,GAAG;AAC5DA,sBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC/C;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvJF,GAAG,WAAW,eAAe;"}