{"version":3,"file":"personalMsg.js","sources":["pages/personalMsg/personalMsg.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGVyc29uYWxNc2cvcGVyc29uYWxNc2cudnVl"],"sourcesContent":["<template>\n  <view class=\"profile-page\">\n    <view class=\"profile-header\">\n      <view class=\"back-button\" @tap=\"navigateBack\">\n        <text class=\"back-icon\">←</text>\n      </view>\n      <view class=\"avatar-container\">\n\t\t  <image \n          class=\"avatar\" \n          :src=\"userInfo.avatar\" \n          mode=\"widthFix\"\n        ></image>\n      </view>\n    </view>\n\n    <view class=\"info-list\">\n\t\t<view \n        :class=\"[\n          'info-item',\n          { 'editable-item': item.canEdit }\n        ]\"\n        v-for=\"(item, index) in infoItems\" \n        :key=\"index\"\n        @tap=\"handleInfoEdit(item)\"\n      >\n        <view class=\"info-label\">{{ item.label }}</view>\n        <view class=\"info-value-wrap\">\n          <text class=\"info-value\">{{ item.value }}</text>\n          <text class=\"edit-arrow\" v-if=\"item.canEdit\">→</text>\n        </view>\n      </view>\n    </view>\n\n    <view class=\"logout-container\">\n      <button \n        class=\"logout-button\" \n        @click=\"handleLogout\"\n      >\n        退出登录\n      </button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\n\nconst userInfo = reactive({\n  avatar: '/static/default-avatar.png', // 本地默认头像路径（确保文件存在）\n  name: '未设置',\n  identity: '未登录',\n  gender: '未设置',\n  college: '未设置',\n  className: '未设置',\n  major: '未设置',\n  studentId: '未设置',\n  teacherId: '',\n  contact: '未设置'\n});\n\nconst infoItems = ref([]); // 列表数据（响应式）\nconst editableFields = [\n  { label: '性别', field: 'gender', type: 'select', options: ['男', '女', '保密'] },\n  { label: '学院', field: 'college', type: 'input', placeholder: '请输入学院名称' },\n  { label: '班级', field: 'className', type: 'input', placeholder: '请输入班级（如计科2301）' },\n  { label: '专业', field: 'major', type: 'input', placeholder: '请输入专业名称' },\n  { label: '联系方式', field: 'contact', type: 'input', placeholder: '请输入手机号' }\n];\n\nconst navigateBack = () => {\n  uni.navigateBack({ delta: 1 }).catch(() => {\n    uni.redirectTo({ url: '/pages/my/my' });\n  });\n};\n\nconst handleInfoEdit = (item) => {\n  const fieldConfig = editableFields.find(config => config.label === item.label);\n  if (!fieldConfig) return;\n\n  if (fieldConfig.type === 'select') {\n    uni.showActionSheet({\n      itemList: fieldConfig.options,\n      success: (res) => {\n        const selectedValue = fieldConfig.options[res.tapIndex];\n        userInfo[fieldConfig.field] = selectedValue; // 更新响应式数据\n        updateInfoListAndStorage(); // 同步列表和存储\n      },\n      fail: (err) => console.error('选择失败:', err)\n    });\n  } \n  // 输入型弹窗（如学院、班级）\n  else if (fieldConfig.type === 'input') {\n    uni.showModal({\n      title: `修改${item.label}`,\n      editable: true,\n      placeholderText: fieldConfig.placeholder,\n      value: item.value !== '未设置' ? item.value : '', \n      success: (res) => {\n        if (res.confirm && res.content.trim()) { \n          const inputValue = res.content.trim();\n          userInfo[fieldConfig.field] = inputValue; // 更新响应式数据\n          updateInfoListAndStorage(); // 同步列表和存储\n        }\n      },\n      fail: (err) => console.error('输入弹窗失败:', err)\n    });\n  }\n};\n\n//  同步列表数据 + 保存到本地存储\nconst updateInfoListAndStorage = () => {\n\n  infoItems.value = [\n    { label: '姓名', value: userInfo.name, canEdit: false },\n    { label: '身份', value: userInfo.identity, canEdit: false },\n    { label: '性别', value: userInfo.gender, canEdit: true },\n    { label: '学院', value: userInfo.college, canEdit: true },\n    { label: '班级', value: userInfo.className, canEdit: true },\n    { label: '专业', value: userInfo.major, canEdit: true },\n    { \n      label: userInfo.identity === '老师' ? '教工号' : '学号', \n      value: userInfo.teacherId || userInfo.studentId, \n      canEdit: false \n    },\n    { label: '联系方式', value: userInfo.contact, canEdit: true }\n  ];\n\n  try {\n    const oldUserInfo = uni.getStorageSync('userInfo') || {};\n    const newUserInfo = { ...oldUserInfo, ...userInfo }; \n    uni.setStorageSync('userInfo', newUserInfo);\n    console.log('用户信息已保存到本地:', newUserInfo);\n  } catch (err) {\n    console.error('保存失败:', err);\n    uni.showToast({ title: '保存失败，请重试', icon: 'none' });\n  }\n};\n\nconst handleLogout = () => {\n  uni.showModal({\n    title: '确认退出',\n    content: '退出后需重新登录，是否继续？',\n    confirmText: '退出',\n    cancelText: '取消',\n    success: (res) => {\n      if (res.confirm) {\n        // 清除用户登录状态\n        try {\n          uni.removeStorageSync('userInfo');\n        } catch (err) {\n          console.error('清除登录状态失败:', err);\n        }\n        uni.showToast({ title: '已退出登录', icon: 'none', duration: 1500 });\n        // 延迟跳转，确保提示可见\n        setTimeout(() => {\n          uni.redirectTo({ url: '/pages/login/login' });\n        }, 1500);\n      }\n    }\n  });\n};\n\nonMounted(() => {\n  try {\n    const storedUserInfo = uni.getStorageSync('userInfo');\n    if (storedUserInfo) {\n      Object.keys(userInfo).forEach(key => {\n        if (storedUserInfo[key] !== undefined && storedUserInfo[key] !== '') {\n          userInfo[key] = storedUserInfo[key];\n        }\n      });\n      userInfo.identity = userInfo.teacherId?.startsWith('Z') ? '老师' : '学生';\n    }\n  } catch (err) {\n    console.error('读取用户信息失败:', err);\n    uni.showToast({ title: '信息加载失败', icon: 'none' });\n  }\n  // 初始化列表数据\n  updateInfoListAndStorage();\n});\n\n</script>\n\n<style scoped>\n/* 样式保持不变，无需修改 */\n.profile-page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  font-size: 16px;\n  padding-bottom: 100rpx; \n}\n\n.profile-header {\n  height: 200rpx;\n  background: linear-gradient(to bottom, #87CEEB, #F5F5F5); \n  position: relative;\n  transition: height 0.3s ease;\n  padding-top: 40rpx; \n}\n\n.back-button {\n  position: absolute;\n  left: 20rpx; \n  top: 40rpx; \n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  background-color: rgba(255, 255, 255, 0.2); \n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10; \n  transition: background-color 0.2s;\n}\n\n.back-button:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.back-icon {\n  color: #fff; \n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.avatar-container {\n  position: absolute;\n  left: 50%;\n  bottom: -60rpx;\n  transform: translateX(-50%);\n  width: 120rpx;\n  height: 120rpx;\n  border: 5rpx solid #fff;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: #fff;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.avatar {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  transition: transform 0.3s ease;\n}\n\n.avatar:active {\n  transform: scale(0.95);\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20rpx); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n.info-list {\n  margin-top: 80rpx;\n  max-width: 700rpx;\n  margin-left: auto;\n  margin-right: auto;\n  padding: 0 30rpx;\n  animation: fadeIn 0.5s ease;\n  background-color: #fff;\n  border-radius: 20rpx;\n  overflow: hidden;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n.info-item {\n  display: flex;\n  padding: 30rpx 0;\n  border-bottom: 1px solid #eaeaea;\n  background-color: #fff;\n  transition: background-color 0.2s;\n  justify-content: flex-start;\n  align-items: center;\n}\n\n.editable-item {\n  cursor: pointer;\n}\n.editable-item:active {\n  background-color: #fafafa;\n}\n\n.info-value-wrap {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-right: 20rpx;\n}\n\n.info-label {\n  width: 200rpx;\n  color: #666;\n  padding-left: 20rpx;\n  font-weight: normal;\n  text-align: left;\n}\n\n.info-value {\n  color: #333;\n  font-weight: 500;\n  text-align: left;\n}\n\n.edit-arrow {\n  color: #ccc;\n  font-size: 24rpx;\n  margin-left: 10rpx;\n}\n\n.info-item:last-child {\n  border-bottom: none;\n}\n\n.logout-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 60rpx;\n  padding: 0 30rpx;\n}\n\n.logout-button {\n  width: 100%;\n  max-width: 700rpx;\n  height: 100rpx;\n  line-height: 100rpx;\n  background-color: #ff4d4f;\n  color: #fff;\n  border-radius: 50rpx;\n  font-size: 34rpx;\n  border: none;\n  box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.3);\n  transition: all 0.2s;\n}\n\n.logout-button:active {\n  background-color: #d9363e;\n  transform: scale(0.98);\n}\n\n.logout-button::after {\n  border: none;\n}\n</style>\n","import MiniProgramPage from 'D:/小程序/HBuilderX.4.75.2025071105/dx-project/dxuniapp/pages/personalMsg/personalMsg.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","onMounted"],"mappings":"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"}