{"version":3,"file":"personalMsg.js","sources":["pages/personalMsg/personalMsg.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGVyc29uYWxNc2cvcGVyc29uYWxNc2cudnVl"],"sourcesContent":["<template>\r\n  <view class=\"profile-page\">\r\n    <view class=\"profile-header\">\r\n      <view class=\"back-button\" @tap=\"navigateBack\">\r\n        <text class=\"back-icon\">←</text>\r\n      </view>\r\n      <view class=\"avatar-container\">\r\n        <image \r\n          class=\"avatar\" \r\n          :src=\"userInfo.avatar\" \r\n          mode=\"widthFix\"\r\n        />\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"info-list\">\r\n      <view \r\n        :class=\"[\r\n          'info-item',\r\n          { 'editable-item': item.canEdit }\r\n        ]\"\r\n        v-for=\"(item, index) in infoItems\" \r\n        :key=\"index\"\r\n        @tap=\"handleInfoEdit(item)\"\r\n      >\r\n        <view class=\"info-label\">{{ item.label }}</view>\r\n        <view class=\"info-value-wrap\">\r\n          <text class=\"info-value\">{{ item.value }}</text>\r\n          <text class=\"edit-arrow\" v-if=\"item.canEdit\">→</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"logout-container\">\r\n      <button \r\n        class=\"logout-button\" \r\n        @click=\"handleLogout\"\r\n      >\r\n        退出登录\r\n      </button>\r\n      <text class=\"logout-tip\">点击退出登录后，个人信息将全部清空</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { userInfoUtil } from '/utils/personnalMsg/userInfoUtil';\nimport { logoutUtil } from '/utils/personnalMsg/logoutUtil';\nimport { storageUtil } from '/utils/personnalMsg/storage.js';\nconst userInfo = reactive({\n  avatar: '/static/default-avatar.png',\n  name: '未设置',\n  identity: '未登录',\n  gender: '未设置',\n  college: '未设置',\n  className: '未设置',\n  major: '未设置',\n  studentID: '未设置',\n  teacherID: '',\n  department: '未设置' \n});\nconst infoItems = ref([]); \nconst navigateBack = () => {\n  uni.navigateBack({ delta: 1 }).catch(() => {\n    uni.switchTab({ url: '/pages/my/my' });\n  });\n};\nconst handleInfoEdit = (item) => {\n  if (!item.canEdit) return;\n  const editableFields = userInfoUtil.getEditableFields(userInfo.identity);\n  const fieldConfig = editableFields.find(cfg => cfg.label === item.label);\n  if (!fieldConfig) return;\n\n  if (fieldConfig.type === 'select') {\n    uni.showActionSheet({\n      itemList: fieldConfig.options,\n      success: (res) => {\n        userInfo[fieldConfig.field] = fieldConfig.options[res.tapIndex];\n        updateInfoAndStorage();\n      },\n      fail: (err) => console.error('编辑失败:', err)\n    });\n  } else if (fieldConfig.type === 'input') {\n    uni.showModal({\n      title: `修改${item.label}`,\n      editable: true,\n      placeholderText: fieldConfig.placeholder,\n      value: item.value !== '未设置' ? item.value : '',\n      success: (res) => {\n        if (res.confirm && res.content.trim()) {\n          userInfo[fieldConfig.field] = res.content.trim();\n          updateInfoAndStorage();\n        }\n      },\n      fail: (err) => console.error('编辑失败:', err)\n    });\n  }\n};\n// 同步信息列表+本地存储\nconst updateInfoAndStorage = () => {\n  infoItems.value = userInfoUtil.generateInfoList(userInfo);\n  storageUtil.saveUserInfo(userInfo);\n};\n// 退出登录\nconst handleLogout = () => {\n  logoutUtil.doLogout(); \n};\n// 页面挂载：初始化用户信息\nonMounted(() => {\n  userInfoUtil.initFromStorage(userInfo);\n  updateInfoAndStorage();\n  console.log('个人页初始化后身份信息:', userInfo.identity);\n});\n</script>\r\n\r\n<style scoped>\r\n.profile-page {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n  font-size: 16px;\r\n  padding-bottom: 100rpx; \r\n}\r\n\r\n.profile-header {\r\n  height: 200rpx;\r\n  background: linear-gradient(to bottom, #87CEEB, #F5F5F5); \r\n  position: relative;\r\n  transition: height 0.3s ease;\r\n  padding-top: 40rpx; \r\n}\r\n\r\n.back-button {\r\n  position: absolute;\r\n  left: 20rpx; \r\n  top: 40rpx; \r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  border-radius: 50%;\r\n  background-color: rgba(255, 255, 255, 0.2); \r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 10; \r\n  transition: background-color 0.2s;\r\n}\r\n\r\n.back-button:active {\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.back-icon {\r\n  color: #fff; \r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.avatar-container {\r\n  position: absolute;\r\n  left: 50%;\r\n  bottom: -60rpx;\r\n  transform: translateX(-50%);\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border: 5rpx solid #fff;\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  background-color: #fff;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.avatar {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 50%;\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.avatar:active {\r\n  transform: scale(0.95);\r\n}\r\n\r\n@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(20rpx); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.info-list {\r\n  margin-top: 80rpx;\r\n  max-width: 700rpx;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  padding: 0 30rpx;\r\n  animation: fadeIn 0.5s ease;\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  padding: 30rpx 0;\r\n  border-bottom: 1px solid #eaeaea;\r\n  background-color: #fff;\r\n  transition: background-color 0.2s;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n}\r\n\r\n.editable-item {\r\n  cursor: pointer;\r\n}\r\n.editable-item:active {\r\n  background-color: #fafafa;\r\n}\r\n\r\n.info-value-wrap {\r\n  flex: 1;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding-right: 20rpx;\r\n}\r\n\r\n.info-label {\r\n  width: 200rpx;\r\n  color: #666;\r\n  padding-left: 20rpx;\r\n  font-weight: normal;\r\n  text-align: left;\r\n}\r\n\r\n.info-value {\r\n  color: #333;\r\n  font-weight: 500;\r\n  text-align: left;\r\n}\r\n\r\n.edit-arrow {\r\n  color: #ccc;\r\n  font-size: 24rpx;\r\n  margin-left: 10rpx;\r\n}\r\n\r\n.info-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.logout-container {\r\n  display: flex;\r\n  flex-direction: column; /* 改为纵向排列：按钮在上，文字在下 */\r\n  justify-content: center;\r\n  margin-top: 60rpx;\r\n  padding: 0 30rpx;\r\n  gap: 15rpx; /* 按钮和文字之间的间距 */\r\n}\r\n\r\n.logout-button {\r\n  width: 100%;\r\n  max-width: 700rpx;\r\n  height: 100rpx;\r\n  line-height: 100rpx;\r\n  background-color: #ff4d4f;\r\n  color: #fff;\r\n  border-radius: 50rpx;\r\n  font-size: 34rpx;\r\n  border: none;\r\n  box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.3);\r\n  transition: all 0.2s;\r\n}\r\n\r\n.logout-button:active {\r\n  background-color: #d9363e;\r\n  transform: scale(0.98);\r\n}\r\n\r\n.logout-button::after {\r\n  border: none;\r\n}\r\n.logout-tip {\r\n  font-size: 24rpx; \r\n  color: #999;\r\n  text-align: center; \r\n  padding: 0 20rpx; \r\n}\r\n</style>","import MiniProgramPage from 'D:/小程序/HBuilderX.4.75.2025071105/dx-project/Uniapp/pages/personalMsg/personalMsg.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","userInfoUtil","storageUtil","logoutUtil","onMounted"],"mappings":";;;;;;;;AAkDA,UAAM,WAAWA,cAAAA,SAAS;AAAA,MACxB,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,WAAW;AAAA,MACX,OAAO;AAAA,MACP,WAAW;AAAA,MACX,WAAW;AAAA,MACX,YAAY;AAAA,IACd,CAAC;AACD,UAAM,YAAYC,cAAAA,IAAI,CAAA,CAAE;AACxB,UAAM,eAAe,MAAM;AACzBC,oBAAG,MAAC,aAAa,EAAE,OAAO,EAAG,CAAA,EAAE,MAAM,MAAM;AACzCA,sBAAAA,MAAI,UAAU,EAAE,KAAK,eAAgB,CAAA;AAAA,MACzC,CAAG;AAAA,IACH;AACA,UAAM,iBAAiB,CAAC,SAAS;AAC/B,UAAI,CAAC,KAAK;AAAS;AACnB,YAAM,iBAAiBC,gCAAY,aAAC,kBAAkB,SAAS,QAAQ;AACvE,YAAM,cAAc,eAAe,KAAK,SAAO,IAAI,UAAU,KAAK,KAAK;AACvE,UAAI,CAAC;AAAa;AAElB,UAAI,YAAY,SAAS,UAAU;AACjCD,sBAAAA,MAAI,gBAAgB;AAAA,UAClB,UAAU,YAAY;AAAA,UACtB,SAAS,CAAC,QAAQ;AAChB,qBAAS,YAAY,KAAK,IAAI,YAAY,QAAQ,IAAI,QAAQ;AAC9D;UACD;AAAA,UACD,MAAM,CAAC,QAAQA,oBAAc,MAAA,SAAA,2CAAA,SAAS,GAAG;AAAA,QAC/C,CAAK;AAAA,MACL,WAAa,YAAY,SAAS,SAAS;AACvCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,KAAK,KAAK,KAAK;AAAA,UACtB,UAAU;AAAA,UACV,iBAAiB,YAAY;AAAA,UAC7B,OAAO,KAAK,UAAU,QAAQ,KAAK,QAAQ;AAAA,UAC3C,SAAS,CAAC,QAAQ;AAChB,gBAAI,IAAI,WAAW,IAAI,QAAQ,KAAI,GAAI;AACrC,uBAAS,YAAY,KAAK,IAAI,IAAI,QAAQ;AAC1C;YACD;AAAA,UACF;AAAA,UACD,MAAM,CAAC,QAAQA,oBAAc,MAAA,SAAA,2CAAA,SAAS,GAAG;AAAA,QAC/C,CAAK;AAAA,MACF;AAAA,IACH;AAEA,UAAM,uBAAuB,MAAM;AACjC,gBAAU,QAAQC,gCAAAA,aAAa,iBAAiB,QAAQ;AACxDC,6CAAY,aAAa,QAAQ;AAAA,IACnC;AAEA,UAAM,eAAe,MAAM;AACzBC,oCAAU,WAAC,SAAQ;AAAA,IACrB;AAEAC,kBAAAA,UAAU,MAAM;AACdH,mDAAa,gBAAgB,QAAQ;AACrC;AACAD,oBAAY,MAAA,MAAA,OAAA,4CAAA,gBAAgB,SAAS,QAAQ;AAAA,IAC/C,CAAC;;;;;;;;;;;;;;;;;;;;;;;;AChHD,GAAG,WAAW,eAAe;"}