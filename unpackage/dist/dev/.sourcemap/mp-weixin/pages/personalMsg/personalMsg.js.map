{"version":3,"file":"personalMsg.js","sources":["pages/personalMsg/personalMsg.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGVyc29uYWxNc2cvcGVyc29uYWxNc2cudnVl"],"sourcesContent":["<template>\n  <view class=\"profile-page\">\n    <view class=\"profile-header\">\n      <view class=\"back-button\" @tap=\"navigateBack\">\n        <text class=\"back-icon\">←</text>\n      </view>\n      <view class=\"avatar-container\">\n        <image \n          class=\"avatar\" \n          :src=\"userInfo.avatar\" \n          mode=\"widthFix\"\n        />\n      </view>\n    </view>\n\n    <view class=\"info-list\">\n      <view \n        :class=\"[\n          'info-item',\n          { 'editable-item': item.canEdit }\n        ]\"\n        v-for=\"(item, index) in infoItems\" \n        :key=\"index\"\n        @tap=\"handleInfoEdit(item)\"\n      >\n        <view class=\"info-label\">{{ item.label }}</view>\n        <view class=\"info-value-wrap\">\n          <text class=\"info-value\">{{ item.value }}</text>\n          <text class=\"edit-arrow\" v-if=\"item.canEdit\">→</text>\n        </view>\n      </view>\n    </view>\n\n    <view class=\"logout-container\">\n      <button \n        class=\"logout-button\" \n        @click=\"handleLogout\"\n      >\n        退出登录\n      </button>\n      <text class=\"logout-tip\">点击退出登录后，个人信息将全部清空</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { userInfoUtil } from '/utils/personnalMsg/userInfoUtil';\nimport { logoutUtil } from '/utils/personnalMsg/logoutUtil';\nimport { storageUtil } from '/utils/personnalMsg/storage.js';\n\n//  响应式数据\nconst userInfo = reactive({\n  avatar: '/static/default-avatar.png',\n  name: '未设置',\n  identity: '未登录',\n  gender: '未设置',\n  college: '未设置',\n  className: '未设置',\n  major: '未设置',\n  studentID: '未设置',\n  teacherID: '',\n});\nconst infoItems = ref([]); \n\n\n// 页面导航：返回上一页\nconst navigateBack = () => {\n  uni.navigateBack({ delta: 1 }).catch(() => {\n    uni.redirectTo({ url: '/pages/my/my' });\n  });\n};\n\n\n// 信息编辑：调用userInfoUtil获取配置，避免硬编码\nconst handleInfoEdit = (item) => {\n  if (!item.canEdit) return;\n  const editableFields = userInfoUtil.getEditableFields(userInfo.identity);\n  const fieldConfig = editableFields.find(cfg => cfg.label === item.label);\n  if (!fieldConfig) return;\n\n  // 下拉选择（性别）\n  if (fieldConfig.type === 'select') {\n    uni.showActionSheet({\n      itemList: fieldConfig.options,\n      success: (res) => {\n        userInfo[fieldConfig.field] = fieldConfig.options[res.tapIndex];\n        updateInfoAndStorage(); // 同步列表+存储\n      },\n      fail: (err) => console.error('编辑失败:', err)\n    });\n  } \n  // 输入框（学院/班级/专业）\n  else if (fieldConfig.type === 'input') {\n    uni.showModal({\n      title: `修改${item.label}`,\n      editable: true,\n      placeholderText: fieldConfig.placeholder,\n      value: item.value !== '未设置' ? item.value : '',\n      success: (res) => {\n        if (res.confirm && res.content.trim()) {\n          userInfo[fieldConfig.field] = res.content.trim();\n          updateInfoAndStorage(); // 同步列表+存储\n        }\n      },\n      fail: (err) => console.error('编辑失败:', err)\n    });\n  }\n};\n\n\n//  同步信息列表+本地存储（调用工具简化逻辑）\nconst updateInfoAndStorage = () => {\n  infoItems.value = userInfoUtil.generateInfoList(userInfo);\n  storageUtil.saveUserInfo(userInfo);\n};\n// 退出登录：直接调用logoutUtil\nconst handleLogout = () => {\n  logoutUtil.doLogout(); \n};\n// 页面挂载：初始化用户信息\nonMounted(() => {\n  userInfoUtil.initFromStorage(userInfo);\n  updateInfoAndStorage();\n});\n</script>\n    \n\n<style scoped>\n.profile-page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  font-size: 16px;\n  padding-bottom: 100rpx; \n}\n\n.profile-header {\n  height: 200rpx;\n  background: linear-gradient(to bottom, #87CEEB, #F5F5F5); \n  position: relative;\n  transition: height 0.3s ease;\n  padding-top: 40rpx; \n}\n\n.back-button {\n  position: absolute;\n  left: 20rpx; \n  top: 40rpx; \n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  background-color: rgba(255, 255, 255, 0.2); \n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10; \n  transition: background-color 0.2s;\n}\n\n.back-button:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.back-icon {\n  color: #fff; \n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.avatar-container {\n  position: absolute;\n  left: 50%;\n  bottom: -60rpx;\n  transform: translateX(-50%);\n  width: 120rpx;\n  height: 120rpx;\n  border: 5rpx solid #fff;\n  border-radius: 50%;\n  overflow: hidden;\n  background-color: #fff;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.avatar {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  transition: transform 0.3s ease;\n}\n\n.avatar:active {\n  transform: scale(0.95);\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20rpx); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n.info-list {\n  margin-top: 80rpx;\n  max-width: 700rpx;\n  margin-left: auto;\n  margin-right: auto;\n  padding: 0 30rpx;\n  animation: fadeIn 0.5s ease;\n  background-color: #fff;\n  border-radius: 20rpx;\n  overflow: hidden;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n.info-item {\n  display: flex;\n  padding: 30rpx 0;\n  border-bottom: 1px solid #eaeaea;\n  background-color: #fff;\n  transition: background-color 0.2s;\n  justify-content: flex-start;\n  align-items: center;\n}\n\n.editable-item {\n  cursor: pointer;\n}\n.editable-item:active {\n  background-color: #fafafa;\n}\n\n.info-value-wrap {\n  flex: 1;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-right: 20rpx;\n}\n\n.info-label {\n  width: 200rpx;\n  color: #666;\n  padding-left: 20rpx;\n  font-weight: normal;\n  text-align: left;\n}\n\n.info-value {\n  color: #333;\n  font-weight: 500;\n  text-align: left;\n}\n\n.edit-arrow {\n  color: #ccc;\n  font-size: 24rpx;\n  margin-left: 10rpx;\n}\n\n.info-item:last-child {\n  border-bottom: none;\n}\n\n.logout-container {\n  display: flex;\n  flex-direction: column; /* 改为纵向排列：按钮在上，文字在下 */\n  justify-content: center;\n  margin-top: 60rpx;\n  padding: 0 30rpx;\n  gap: 15rpx; /* 按钮和文字之间的间距 */\n}\n\n.logout-button {\n  width: 100%;\n  max-width: 700rpx;\n  height: 100rpx;\n  line-height: 100rpx;\n  background-color: #ff4d4f;\n  color: #fff;\n  border-radius: 50rpx;\n  font-size: 34rpx;\n  border: none;\n  box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.3);\n  transition: all 0.2s;\n}\n\n.logout-button:active {\n  background-color: #d9363e;\n  transform: scale(0.98);\n}\n\n.logout-button::after {\n  border: none;\n}\n.logout-tip {\n  font-size: 24rpx; \n  color: #999;\n  text-align: center; \n  padding: 0 20rpx; \n}\n</style>","import MiniProgramPage from 'D:/小程序/HBuilderX.4.75.2025071105/dx-project/Uniapp/pages/personalMsg/personalMsg.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","userInfoUtil","storageUtil","logoutUtil","onMounted"],"mappings":";;;;;;;;AAoDA,UAAM,WAAWA,cAAAA,SAAS;AAAA,MACxB,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,WAAW;AAAA,MACX,OAAO;AAAA,MACP,WAAW;AAAA,MACX,WAAW;AAAA,IACb,CAAC;AACD,UAAM,YAAYC,cAAAA,IAAI,CAAA,CAAE;AAIxB,UAAM,eAAe,MAAM;AACzBC,oBAAG,MAAC,aAAa,EAAE,OAAO,EAAG,CAAA,EAAE,MAAM,MAAM;AACzCA,sBAAAA,MAAI,WAAW,EAAE,KAAK,eAAgB,CAAA;AAAA,MAC1C,CAAG;AAAA,IACH;AAIA,UAAM,iBAAiB,CAAC,SAAS;AAC/B,UAAI,CAAC,KAAK;AAAS;AACnB,YAAM,iBAAiBC,gCAAY,aAAC,kBAAkB,SAAS,QAAQ;AACvE,YAAM,cAAc,eAAe,KAAK,SAAO,IAAI,UAAU,KAAK,KAAK;AACvE,UAAI,CAAC;AAAa;AAGlB,UAAI,YAAY,SAAS,UAAU;AACjCD,sBAAAA,MAAI,gBAAgB;AAAA,UAClB,UAAU,YAAY;AAAA,UACtB,SAAS,CAAC,QAAQ;AAChB,qBAAS,YAAY,KAAK,IAAI,YAAY,QAAQ,IAAI,QAAQ;AAC9D;UACD;AAAA,UACD,MAAM,CAAC,QAAQA,oBAAc,MAAA,SAAA,2CAAA,SAAS,GAAG;AAAA,QAC/C,CAAK;AAAA,MACF,WAEQ,YAAY,SAAS,SAAS;AACrCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,KAAK,KAAK,KAAK;AAAA,UACtB,UAAU;AAAA,UACV,iBAAiB,YAAY;AAAA,UAC7B,OAAO,KAAK,UAAU,QAAQ,KAAK,QAAQ;AAAA,UAC3C,SAAS,CAAC,QAAQ;AAChB,gBAAI,IAAI,WAAW,IAAI,QAAQ,KAAI,GAAI;AACrC,uBAAS,YAAY,KAAK,IAAI,IAAI,QAAQ;AAC1C;YACD;AAAA,UACF;AAAA,UACD,MAAM,CAAC,QAAQA,oBAAc,MAAA,SAAA,4CAAA,SAAS,GAAG;AAAA,QAC/C,CAAK;AAAA,MACF;AAAA,IACH;AAIA,UAAM,uBAAuB,MAAM;AACjC,gBAAU,QAAQC,gCAAAA,aAAa,iBAAiB,QAAQ;AACxDC,6CAAY,aAAa,QAAQ;AAAA,IACnC;AAEA,UAAM,eAAe,MAAM;AACzBC,oCAAU,WAAC,SAAQ;AAAA,IACrB;AAEAC,kBAAAA,UAAU,MAAM;AACdH,mDAAa,gBAAgB,QAAQ;AACrC;IACF,CAAC;;;;;;;;;;;;;;;;;;;;;;;;AC3HD,GAAG,WAAW,eAAe;"}