{"version":3,"file":"personalMsg.js","sources":["pages/personalMsg/personalMsg.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGVyc29uYWxNc2cvcGVyc29uYWxNc2cudnVl"],"sourcesContent":["<template>\r\n  <view class=\"profile-page\">\r\n    <view class=\"profile-header\">\r\n      <view class=\"back-button\" @tap=\"navigateBack\">\r\n        <text class=\"back-icon\">←</text>\r\n      </view>\r\n      <view class=\"avatar-container\">\r\n\t\t  <image \r\n          class=\"avatar\" \r\n          :src=\"userInfo.avatar\" \r\n          mode=\"widthFix\"\r\n        ></image>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"info-list\">\r\n\t\t<view \r\n        :class=\"[\r\n          'info-item',\r\n          { 'editable-item': item.canEdit }\r\n        ]\"\r\n        v-for=\"(item, index) in infoItems\" \r\n        :key=\"index\"\r\n        @tap=\"handleInfoEdit(item)\"\r\n      >\r\n        <view class=\"info-label\">{{ item.label }}</view>\r\n        <view class=\"info-value-wrap\">\r\n          <text class=\"info-value\">{{ item.value }}</text>\r\n          <text class=\"edit-arrow\" v-if=\"item.canEdit\">→</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"logout-container\">\r\n      <button \r\n        class=\"logout-button\" \r\n        @click=\"handleLogout\"\r\n      >\r\n        退出登录\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue';\r\n\r\nconst userInfo = reactive({\r\n  avatar: '/static/default-avatar.png', // 本地默认头像路径（确保文件存在）\r\n  name: '未设置',\r\n  identity: '未登录',\r\n  gender: '未设置',\r\n  college: '未设置',\r\n  className: '未设置',\r\n  major: '未设置',\r\n  studentId: '未设置',\r\n  teacherId: '',\r\n  contact: '未设置'\r\n});\r\n\r\nconst infoItems = ref([]); // 列表数据（响应式）\r\nconst editableFields = [\r\n  { label: '性别', field: 'gender', type: 'select', options: ['男', '女', '保密'] },\r\n  { label: '学院', field: 'college', type: 'input', placeholder: '请输入学院名称' },\r\n  { label: '班级', field: 'className', type: 'input', placeholder: '请输入班级（如计科2301）' },\r\n  { label: '专业', field: 'major', type: 'input', placeholder: '请输入专业名称' },\r\n  { label: '联系方式', field: 'contact', type: 'input', placeholder: '请输入手机号' }\r\n];\r\n\r\nconst navigateBack = () => {\r\n  uni.navigateBack({ delta: 1 }).catch(() => {\r\n    uni.redirectTo({ url: '/pages/my/my' });\r\n  });\r\n};\r\n\r\nconst handleInfoEdit = (item) => {\r\n  const fieldConfig = editableFields.find(config => config.label === item.label);\r\n  if (!fieldConfig) return;\r\n\r\n  if (fieldConfig.type === 'select') {\r\n    uni.showActionSheet({\r\n      itemList: fieldConfig.options,\r\n      success: (res) => {\r\n        const selectedValue = fieldConfig.options[res.tapIndex];\r\n        userInfo[fieldConfig.field] = selectedValue; // 更新响应式数据\r\n        updateInfoListAndStorage(); // 同步列表和存储\r\n      },\r\n      fail: (err) => console.error('选择失败:', err)\r\n    });\r\n  } \r\n  // 输入型弹窗（如学院、班级）\r\n  else if (fieldConfig.type === 'input') {\r\n    uni.showModal({\r\n      title: `修改${item.label}`,\r\n      editable: true,\r\n      placeholderText: fieldConfig.placeholder,\r\n      value: item.value !== '未设置' ? item.value : '', \r\n      success: (res) => {\r\n        if (res.confirm && res.content.trim()) { \r\n          const inputValue = res.content.trim();\r\n          userInfo[fieldConfig.field] = inputValue; // 更新响应式数据\r\n          updateInfoListAndStorage(); // 同步列表和存储\r\n        }\r\n      },\r\n      fail: (err) => console.error('输入弹窗失败:', err)\r\n    });\r\n  }\r\n};\r\n\r\n//  同步列表数据 + 保存到本地存储\r\nconst updateInfoListAndStorage = () => {\r\n\r\n  infoItems.value = [\r\n    { label: '姓名', value: userInfo.name, canEdit: false },\r\n    { label: '身份', value: userInfo.identity, canEdit: false },\r\n    { label: '性别', value: userInfo.gender, canEdit: true },\r\n    { label: '学院', value: userInfo.college, canEdit: true },\r\n    { label: '班级', value: userInfo.className, canEdit: true },\r\n    { label: '专业', value: userInfo.major, canEdit: true },\r\n    { \r\n      label: userInfo.identity === '老师' ? '教工号' : '学号', \r\n      value: userInfo.teacherId || userInfo.studentId, \r\n      canEdit: false \r\n    },\r\n    { label: '联系方式', value: userInfo.contact, canEdit: true }\r\n  ];\r\n\r\n  try {\r\n    const oldUserInfo = uni.getStorageSync('userInfo') || {};\r\n    const newUserInfo = { ...oldUserInfo, ...userInfo }; \r\n    uni.setStorageSync('userInfo', newUserInfo);\r\n    console.log('用户信息已保存到本地:', newUserInfo);\r\n  } catch (err) {\r\n    console.error('保存失败:', err);\r\n    uni.showToast({ title: '保存失败，请重试', icon: 'none' });\r\n  }\r\n};\r\n\r\nconst handleLogout = () => {\r\n  uni.showModal({\r\n    title: '确认退出',\r\n    content: '退出后需重新登录，是否继续？',\r\n    confirmText: '退出',\r\n    cancelText: '取消',\r\n    success: (res) => {\r\n      if (res.confirm) {\r\n        // 清除用户登录状态\r\n        try {\r\n          uni.removeStorageSync('userInfo');\r\n        } catch (err) {\r\n          console.error('清除登录状态失败:', err);\r\n        }\r\n        uni.showToast({ title: '已退出登录', icon: 'none', duration: 1500 });\r\n        // 延迟跳转，确保提示可见\r\n        setTimeout(() => {\r\n          uni.redirectTo({ url: '/pages/login/login' });\r\n        }, 1500);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nonMounted(() => {\r\n  try {\r\n    const storedUserInfo = uni.getStorageSync('userInfo');\r\n    if (storedUserInfo) {\r\n      Object.keys(userInfo).forEach(key => {\r\n        if (storedUserInfo[key] !== undefined && storedUserInfo[key] !== '') {\r\n          userInfo[key] = storedUserInfo[key];\r\n        }\r\n      });\r\n      userInfo.identity = userInfo.teacherId?.startsWith('Z') ? '老师' : '学生';\r\n    }\r\n  } catch (err) {\r\n    console.error('读取用户信息失败:', err);\r\n    uni.showToast({ title: '信息加载失败', icon: 'none' });\r\n  }\r\n  // 初始化列表数据\r\n  updateInfoListAndStorage();\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* 样式保持不变，无需修改 */\r\n.profile-page {\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n  font-size: 16px;\r\n  padding-bottom: 100rpx; \r\n}\r\n\r\n.profile-header {\r\n  height: 200rpx;\r\n  background: linear-gradient(to bottom, #87CEEB, #F5F5F5); \r\n  position: relative;\r\n  transition: height 0.3s ease;\r\n  padding-top: 40rpx; \r\n}\r\n\r\n.back-button {\r\n  position: absolute;\r\n  left: 20rpx; \r\n  top: 40rpx; \r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  border-radius: 50%;\r\n  background-color: rgba(255, 255, 255, 0.2); \r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 10; \r\n  transition: background-color 0.2s;\r\n}\r\n\r\n.back-button:active {\r\n  background-color: rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.back-icon {\r\n  color: #fff; \r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.avatar-container {\r\n  position: absolute;\r\n  left: 50%;\r\n  bottom: -60rpx;\r\n  transform: translateX(-50%);\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border: 5rpx solid #fff;\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  background-color: #fff;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.avatar {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 50%;\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.avatar:active {\r\n  transform: scale(0.95);\r\n}\r\n\r\n@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(20rpx); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.info-list {\r\n  margin-top: 80rpx;\r\n  max-width: 700rpx;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  padding: 0 30rpx;\r\n  animation: fadeIn 0.5s ease;\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  padding: 30rpx 0;\r\n  border-bottom: 1px solid #eaeaea;\r\n  background-color: #fff;\r\n  transition: background-color 0.2s;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n}\r\n\r\n.editable-item {\r\n  cursor: pointer;\r\n}\r\n.editable-item:active {\r\n  background-color: #fafafa;\r\n}\r\n\r\n.info-value-wrap {\r\n  flex: 1;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding-right: 20rpx;\r\n}\r\n\r\n.info-label {\r\n  width: 200rpx;\r\n  color: #666;\r\n  padding-left: 20rpx;\r\n  font-weight: normal;\r\n  text-align: left;\r\n}\r\n\r\n.info-value {\r\n  color: #333;\r\n  font-weight: 500;\r\n  text-align: left;\r\n}\r\n\r\n.edit-arrow {\r\n  color: #ccc;\r\n  font-size: 24rpx;\r\n  margin-left: 10rpx;\r\n}\r\n\r\n.info-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.logout-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: 60rpx;\r\n  padding: 0 30rpx;\r\n}\r\n\r\n.logout-button {\r\n  width: 100%;\r\n  max-width: 700rpx;\r\n  height: 100rpx;\r\n  line-height: 100rpx;\r\n  background-color: #ff4d4f;\r\n  color: #fff;\r\n  border-radius: 50rpx;\r\n  font-size: 34rpx;\r\n  border: none;\r\n  box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.3);\r\n  transition: all 0.2s;\r\n}\r\n\r\n.logout-button:active {\r\n  background-color: #d9363e;\r\n  transform: scale(0.98);\r\n}\r\n\r\n.logout-button::after {\r\n  border: none;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/PJ-system/uniapp/pages/personalMsg/personalMsg.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","onMounted"],"mappings":"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"}