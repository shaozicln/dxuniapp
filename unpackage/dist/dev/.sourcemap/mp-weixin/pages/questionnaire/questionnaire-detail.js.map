{"version":3,"file":"questionnaire-detail.js","sources":["pages/questionnaire/questionnaire-detail.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcXVlc3Rpb25uYWlyZS9xdWVzdGlvbm5haXJlLWRldGFpbC52dWU"],"sourcesContent":["<template>\n  <view class=\"questionnaire-detail-page\">\n    <!-- 顶部导航栏：添加 questionnaire 存在的判断 -->\n    <view class=\"page-header\" v-if=\"questionnaire\">\n      <view class=\"back-button\" @click=\"handleBack\">\n        <text class=\"back-icon\">←</text>\n      </view>\n      <view class=\"header-title\">{{ questionnaire.title }}</view>\n    </view>\n\n    <!-- 加载中状态：数据未加载时显示 -->\n    <view class=\"loading-state\" v-else>\n      <text>加载中...</text>\n    </view>\n\n    <!-- 问卷内容区域：同样添加判断 -->\n    <view class=\"questionnaire-content\" v-if=\"questionnaire\">\n      <view class=\"question-item\" v-for=\"(question, qIndex) in questionnaire.questions\" :key=\"qIndex\">\n        <view class=\"question-number\">{{ qIndex + 1 }}.</view>\n        <view class=\"question-text\">{{ question.text }}</view>\n        <view class=\"question-options\">\n          <view \n            class=\"option-item\" \n            v-for=\"(option, oIndex) in question.options\" \n            :key=\"oIndex\"\n            :class=\"{ selected: isOptionSelected(question.id, option.id) }\"\n            @click=\"selectOption(question.id, option.id)\"\n          >\n            {{ option.text }}\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 底部操作区：添加判断 -->\n    <view class=\"bottom-actions\" v-if=\"questionnaire\">\n      <view \n        class=\"reset-btn\" \n        v-if=\"questionnaire.status === 'completed'\" \n        @click=\"resetQuestionnaire\"\n      >\n        重新填写\n      </view>\n      <button \n        class=\"submit-btn\" \n        v-if=\"questionnaire.status !== 'completed'\" \n        @click=\"submitQuestionnaire\"\n      >\n        提交问卷\n      </button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst questionnaire = ref(null);\n\nonMounted(() => {\n  const pages = getCurrentPages();\n  const currentPage = pages[pages.length - 1];\n  const data = currentPage.options.data;\n  if (data) {\n    // 从路由参数中获取当前问卷数据\n    const currentQuestionnaire = JSON.parse(decodeURIComponent(data));\n    // 从本地存储中读取所有问卷，找到对应问卷（这里主要是为了初始化可能已存在的状态，比如之前提交过的）\n    const allQuestionnaires = JSON.parse(uni.getStorageSync('questionnaires') || '[]');\n    const storedQuestionnaire = allQuestionnaires.find(q => q.id === currentQuestionnaire.id);\n    if (storedQuestionnaire) {\n      questionnaire.value = storedQuestionnaire;\n    } else {\n      questionnaire.value = currentQuestionnaire;\n    }\n  } else {\n    uni.navigateBack();\n  }\n});\n\nconst handleBack = () => {\n  uni.navigateBack({\n    delta: 1\n  });\n};\n\nconst selectOption = (questionId, optionId) => {\n  if (!questionnaire.value) return;\n  const question = questionnaire.value.questions.find(q => q.id === questionId);\n  if (!question) return;\n  if (question.type === 'single' || question.type === 'rating') {\n    question.answer = optionId;\n  } else if (question.type === 'multiple') {\n    if (!question.answer) {\n      question.answer = [optionId];\n    } else if (question.answer.includes(optionId)) {\n      question.answer = question.answer.filter(id => id !== optionId);\n    } else {\n      question.answer.push(optionId);\n    }\n  }\n};\n\nconst isOptionSelected = (questionId, optionId) => {\n  if (!questionnaire.value) return false;\n  const question = questionnaire.value.questions.find(q => q.id === questionId);\n  if (!question || !question.answer) return false;\n  if (question.type === 'single' || question.type === 'rating') {\n    return question.answer === optionId;\n  } else if (question.type === 'multiple') {\n    return question.answer.includes(optionId);\n  }\n  return false;\n};\n\nconst submitQuestionnaire = () => {\n  if (!questionnaire.value) return;\n  const allAnswered = questionnaire.value.questions.every(question => {\n    if (question.type === 'single' || question.type === 'rating') {\n      return question.answer !== null;\n    } else if (question.type === 'multiple') {\n      return question.answer && question.answer.length > 0;\n    }\n    return true;\n  });\n  if (!allAnswered) {\n    uni.showToast({\n      title: '请回答所有问题',\n      icon: 'none'\n    });\n    return;\n  }\n  uni.showLoading({\n    title: '提交中...'\n  });\n  questionnaire.value.status = 'completed';\n  const allQuestionnaires = JSON.parse(uni.getStorageSync('questionnaires') || '[]');\n  const index = allQuestionnaires.findIndex(q => q.id === questionnaire.value.id);\n  if (index !== -1) {\n    allQuestionnaires[index] = JSON.parse(JSON.stringify(questionnaire.value));\n  } else {\n    allQuestionnaires.push(JSON.parse(JSON.stringify(questionnaire.value)));\n  }\n  uni.setStorageSync('questionnaires', JSON.stringify(allQuestionnaires));\n  uni.hideLoading();\n  uni.showToast({\n    title: '提交成功',\n    icon: 'success'\n  });\n  setTimeout(() => {\n    uni.navigateBack({\n      delta: 1\n    });\n  }, 800);\n};\n\nconst resetQuestionnaire = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定要重新填写这份问卷吗？当前答案将被清空。',\n    success: (res) => {\n      if (res.confirm && questionnaire.value) {\n        questionnaire.value.questions.forEach(question => {\n          question.answer = null;\n        });\n        questionnaire.value.status = 'pending';\n        const allQuestionnaires = JSON.parse(uni.getStorageSync('questionnaires') || '[]');\n        const index = allQuestionnaires.findIndex(q => q.id === questionnaire.value.id);\n        if (index !== -1) {\n          allQuestionnaires[index] = JSON.parse(JSON.stringify(questionnaire.value));\n          uni.setStorageSync('questionnaires', JSON.stringify(allQuestionnaires));\n        }\n        uni.showToast({\n          title: '已重置问卷，可重新填写',\n          icon: 'none'\n        });\n      }\n    }\n  });\n};\n</script>\n\n<style scoped>\n.questionnaire-detail-page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  font-size: 16px;\n  padding-bottom: 120rpx; /* 预留底部按钮区域 */\n}\n\n/* 页面头部样式优化 */\n.page-header {\n  height: 120rpx;\n  background-color: #87CEEB;\n  display: flex;\n  align-items: center; \n  justify-content: center; \n  padding: 30rpx 30rpx 15rpx;\n  position: relative;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\n}\n\n.back-button {\n  position: absolute;\n  left: 20rpx; \n  top: 60rpx; \n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  background-color: rgba(255, 255, 255, 0.2); \n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10; \n  transition: background-color 0.2s;\n}\n\n.back-button:active {\n  background-color: rgba(255, 255, 255, 0.3);\n}\n\n.back-icon {\n  color: #fff; \n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n/* 标题样式优化 */\n.header-title {\n  color: #777; \n  font-size: 36rpx;\n  font-weight: 500;\n  flex: 1;\n  text-align: center;\n  margin-left: -100rpx; /* 抵消返回按钮宽度，标题居中 */\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 问卷内容区域 */\n.questionnaire-content {\n  padding: 30rpx;\n}\n\n.question-item {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n  padding-top: 35rpx;\n}\n\n.question-number {\n  font-size: 28rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 15rpx;\n}\n\n.question-text {\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 20rpx;\n  line-height: 1.6; /* 增加行高，提升阅读体验 */\n}\n\n.question-options {\n  display: flex;\n  flex-direction: column;\n  gap: 15rpx;\n}\n\n.option-item {\n  padding: 25rpx 30rpx;\n  border: 1rpx solid #eaeaea;\n  border-radius: 12rpx;\n  font-size: 26rpx;\n  color: #666;\n  transition: all 0.2s;\n}\n\n.option-item.selected {\n  border-color: #42b983;\n  background-color: #e8f5e9;\n  color: #42b983;\n  position: relative;\n}\n\n.option-item.selected::before {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 6rpx;\n  height: 100%;\n  background-color: #42b983;\n  border-radius: 3rpx 0 0 3rpx;\n}\n\n.option-item:active {\n  background-color: #f5f5f5;\n}\n\n/* 底部操作区 */\n.bottom-actions {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  padding: 20rpx 30rpx; \n  background-color: #fff;\n  border-top: 1rpx solid #eaeaea;\n  display: flex;\n  justify-content: center; \n  align-items: center;\n  z-index: 99;\n  box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n/* 提交按钮 */\n.submit-btn {\n  background-color: #87CEEB; \n  color: #fff;\n  border: none;\n  border-radius: 10rpx;\n  width: auto;\n  padding: 25rpx 40rpx; \n  text-align: center;\n  font-size: 30rpx;\n  box-shadow: 0 4rpx 10rpx rgba(135, 206, 235, 0.5); \n  transition: all 0.2s;\n}\n\n.submit-btn:active {\n  background-color: #76b6d9; \n  box-shadow: 0 2rpx 5rpx rgba(135, 206, 235, 0.3);\n  transform: scale(0.99);\n}\n\n/* 重填按钮 */\n.reset-btn {\n  width: auto; \n  padding: 25rpx 40rpx; \n  text-align: center;\n  color: #87CEEB; \n  border: 1rpx solid #87CEEB;\n  border-radius: 10rpx;\n  font-size: 30rpx;\n  background-color: #fff;\n  transition: all 0.2s;\n}\n\n.reset-btn:active {\n  background-color: #e6f2f7; \n  transform: scale(0.99);\n}\n</style>","import MiniProgramPage from 'D:/Uniapp/dxUniapp/pages/questionnaire/questionnaire-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni"],"mappings":"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"}