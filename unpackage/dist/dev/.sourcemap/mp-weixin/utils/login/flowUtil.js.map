{"version":3,"file":"flowUtil.js","sources":["utils/login/flowUtil.js"],"sourcesContent":["import { post } from '../request/request.js';\n// 登录流程工具：封装自动登录、手动登录、微信code获取逻辑\nexport const loginFlowUtil = {\n  // 获取微信登录code\n  async getWxCode() {\n    return new Promise((resolve, reject) => {\n      uni.login({\n        provider: 'weixin',\n        success: (res) => {\n          if (res.code) resolve(res.code);\n          else reject(new Error(`获取微信code失败: ${res.errMsg}`));\n        },\n        fail: (err) => reject(new Error(`微信登录接口失败: ${err.errMsg}`))\n      });\n    });\n  },\n\n  // 自动登录流程（调用后端/loginByCode)\n  async autoLogin(wxCode) {\n    console.log('调用后端/loginByCode接口，请求自动登录');\n    const autoLoginRes = await post('https://jxpj.neau.edu.cn/api/v1/loginByCode', {\n      weixincode: wxCode\n    });\n    // 从本地获取userID\n    const userID = uni.getStorageSync('userID') || '';\n    return { autoLoginRes, userID };\n  },\n\n  // 手动登录流程（调用后端/login）\n  async manualLogin(wxCode, userID) {\n    console.log('调用后端/login接口，提交手动登录信息');\n    return await post('https://jxpj.neau.edu.cn/api/v1/login', {\n      weixincode: wxCode,\n      username: userID,\n      password: userID \n    });\n  },\n\n  validateInput(userID, name) {\n    let trimmedUserID = userID.trim();\n    const trimmedName = name.trim();\n\n    // 非空校验\n    if (!trimmedUserID || !trimmedName) {\n      throw new Error('请输入完整的教工号/学工号和姓名');\n    }\n\n    // 校验学工号格式（A/a + 8位数字）\n    if (/^[Aa]/.test(trimmedUserID)) {\r\n\t\t//.test(trimmedUserID): 测试trimmedUserID是否符合该正则模式\n      if (!/^[Aa]\\d{8}$/.test(trimmedUserID)) {\n        throw new Error('学工号格式错误（应为A/a+8位数字，如A19230111）');\n      }\n      // 统一格式化为大写A开头\n      trimmedUserID = 'A' + trimmedUserID.slice(1).toUpperCase();\n    }\n    // 校验教工号格式（Z/z + 5位数字）\n    else if (/^[Zz]/.test(trimmedUserID)) {\n      if (!/^[Zz]\\d{5}$/.test(trimmedUserID)) {\n        throw new Error('教工号格式错误（应为Z/z+5位数字，如Z10005）');\n      }\n      // 统一格式化为大写Z开头\n      trimmedUserID = 'Z' + trimmedUserID.slice(1).toUpperCase();\n    }\n    else {\n      throw new Error('学工号应为A/a+8位数字，教工号应为Z/z+5位数字');\n    }\n\n    return { trimmedUserID, trimmedName };\n  }\n};"],"names":["uni","post"],"mappings":";;;AAEY,MAAC,gBAAgB;AAAA;AAAA,EAE3B,MAAM,YAAY;AAChB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,oBAAAA,MAAI,MAAM;AAAA,QACR,UAAU;AAAA,QACV,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI;AAAM,oBAAQ,IAAI,IAAI;AAAA;AACzB,mBAAO,IAAI,MAAM,eAAe,IAAI,MAAM,EAAE,CAAC;AAAA,QACnD;AAAA,QACD,MAAM,CAAC,QAAQ,OAAO,IAAI,MAAM,aAAa,IAAI,MAAM,EAAE,CAAC;AAAA,MAClE,CAAO;AAAA,IACP,CAAK;AAAA,EACF;AAAA;AAAA,EAGD,MAAM,UAAU,QAAQ;AACtBA,kBAAAA,MAAA,MAAA,OAAA,iCAAY,2BAA2B;AACvC,UAAM,eAAe,MAAMC,sBAAI,KAAC,+CAA+C;AAAA,MAC7E,YAAY;AAAA,IAClB,CAAK;AAED,UAAM,SAASD,cAAG,MAAC,eAAe,QAAQ,KAAK;AAC/C,WAAO,EAAE,cAAc;EACxB;AAAA;AAAA,EAGD,MAAM,YAAY,QAAQ,QAAQ;AAChCA,kBAAAA,MAAA,MAAA,OAAA,iCAAY,uBAAuB;AACnC,WAAO,MAAMC,sBAAI,KAAC,yCAAyC;AAAA,MACzD,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,UAAU;AAAA,IAChB,CAAK;AAAA,EACF;AAAA,EAED,cAAc,QAAQ,MAAM;AAC1B,QAAI,gBAAgB,OAAO;AAC3B,UAAM,cAAc,KAAK;AAGzB,QAAI,CAAC,iBAAiB,CAAC,aAAa;AAClC,YAAM,IAAI,MAAM,kBAAkB;AAAA,IACnC;AAGD,QAAI,QAAQ,KAAK,aAAa,GAAG;AAE/B,UAAI,CAAC,cAAc,KAAK,aAAa,GAAG;AACtC,cAAM,IAAI,MAAM,gCAAgC;AAAA,MACjD;AAED,sBAAgB,MAAM,cAAc,MAAM,CAAC,EAAE;IAC9C,WAEQ,QAAQ,KAAK,aAAa,GAAG;AACpC,UAAI,CAAC,cAAc,KAAK,aAAa,GAAG;AACtC,cAAM,IAAI,MAAM,6BAA6B;AAAA,MAC9C;AAED,sBAAgB,MAAM,cAAc,MAAM,CAAC,EAAE;IAC9C,OACI;AACH,YAAM,IAAI,MAAM,6BAA6B;AAAA,IAC9C;AAED,WAAO,EAAE,eAAe;EACzB;AACH;;"}