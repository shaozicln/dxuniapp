{"version":3,"file":"logoutUtil.js","sources":["utils/personnalMsg/logoutUtil.js"],"sourcesContent":["import { post } from '../request/request.js';\r\n// 退出登录工具：弹窗确认、接口请求、状态清除\r\nexport const logoutUtil = {\r\n  async doLogout(redirectCb) {\r\n    uni.showModal({\r\n      title: '确认退出',\r\n      content: '退出后需重新登录，是否继续？',\r\n      confirmText: '退出',\r\n      cancelText: '取消',\r\n      success: async (res) => {\r\n        if (res.confirm) {\r\n          await this._handleLogoutRequest(redirectCb);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  async _handleLogoutRequest(redirectCb) {\r\n    try {\r\n      // 2. 获取本地Token\r\n      const token = uni.getStorageSync('autoToken') || uni.getStorageSync('token');\r\n      if (!token) {\r\n        console.warn('logoutUtil: 本地无有效Token，直接清除状态');\r\n        this._clearLoginState(redirectCb);\r\n        return;\r\n      }\r\n\r\n      const res = await post(\r\n        'https://jxpj.neau.edu.cn/api/v1/logout',\r\n        {},\r\n        { headers: { 'Authorization': `Bearer ${token}` } }\r\n      );\r\n\r\n      // 处理接口响应\r\n      if (res?.code === 200) {\r\n        console.log('logoutUtil: 后端退出成功');\r\n        uni.showToast({ title: '已退出登录', icon: 'none', duration: 500 });\r\n        this._clearLoginState(redirectCb);\r\n      } else {\r\n        console.error('logoutUtil: 后端退出失败', res);\r\n        uni.showToast({ title: '退出失败，请重试', icon: 'none' });\r\n      }\r\n    } catch (err) {\r\n      console.error('logoutUtil: 退出请求异常', err);\r\n      uni.showToast({ title: '网络异常，已强制退出', icon: 'none' });\r\n      this._clearLoginState(redirectCb);\r\n    }\r\n  },\r\n\r\n  _clearLoginState(redirectCb) {\r\n    try {\r\n      uni.removeStorageSync('autoToken');\r\n      uni.removeStorageSync('token');\r\n      uni.removeStorageSync('userInfo');\r\n      uni.removeStorageSync('isLogin');\r\n\t    uni.removeStorageSync('userID');\r\n    } catch (err) {\r\n      console.error('logoutUtil: 清除状态失败', err);\r\n    }\r\n    if (typeof redirectCb === 'function') {\r\n      redirectCb();\r\n    } else {\r\n      setTimeout(() => uni.redirectTo({ url: '/pages/login/login' }), 3000);\r\n    }\r\n  }\r\n};"],"names":["uni","post"],"mappings":";;;AAEY,MAAC,aAAa;AAAA,EACxB,MAAM,SAAS,YAAY;AACzBA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,SAAS,OAAO,QAAQ;AACtB,YAAI,IAAI,SAAS;AACf,gBAAM,KAAK,qBAAqB,UAAU;AAAA,QAC3C;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACF;AAAA,EAED,MAAM,qBAAqB,YAAY;AACrC,QAAI;AAEF,YAAM,QAAQA,cAAG,MAAC,eAAe,WAAW,KAAKA,oBAAI,eAAe,OAAO;AAC3E,UAAI,CAAC,OAAO;AACVA,sBAAAA,MAAa,MAAA,QAAA,0CAAA,+BAA+B;AAC5C,aAAK,iBAAiB,UAAU;AAChC;AAAA,MACD;AAED,YAAM,MAAM,MAAMC,sBAAI;AAAA,QACpB;AAAA,QACA,CAAE;AAAA,QACF,EAAE,SAAS,EAAE,iBAAiB,UAAU,KAAK,KAAM;AAAA,MAC3D;AAGM,WAAI,2BAAK,UAAS,KAAK;AACrBD,sBAAAA,MAAA,MAAA,OAAA,0CAAY,oBAAoB;AAChCA,4BAAI,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ,UAAU,IAAG,CAAE;AAC7D,aAAK,iBAAiB,UAAU;AAAA,MACxC,OAAa;AACLA,sBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AACvCA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,OAAM,CAAE;AAAA,MAClD;AAAA,IACF,SAAQ,KAAK;AACZA,oBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AACvCA,oBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,OAAM,CAAE;AACnD,WAAK,iBAAiB,UAAU;AAAA,IACjC;AAAA,EACF;AAAA,EAED,iBAAiB,YAAY;AAC3B,QAAI;AACFA,0BAAI,kBAAkB,WAAW;AACjCA,0BAAI,kBAAkB,OAAO;AAC7BA,0BAAI,kBAAkB,UAAU;AAChCA,0BAAI,kBAAkB,SAAS;AAChCA,0BAAI,kBAAkB,QAAQ;AAAA,IAC9B,SAAQ,KAAK;AACZA,oBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AAAA,IACxC;AACD,QAAI,OAAO,eAAe,YAAY;AACpC;IACN,OAAW;AACL,iBAAW,MAAMA,cAAG,MAAC,WAAW,EAAE,KAAK,qBAAsB,CAAA,GAAG,GAAI;AAAA,IACrE;AAAA,EACF;AACH;;"}