{"version":3,"file":"logoutUtil.js","sources":["utils/personnalMsg/logoutUtil.js"],"sourcesContent":["import { post } from '../request/request.js';\n// 退出登录工具：弹窗确认、接口请求、状态清除\nexport const logoutUtil = {\n  async doLogout(redirectCb) {\n    uni.showModal({\n      title: '确认退出',\n      content: '退出后需重新登录，是否继续？',\n      confirmText: '退出',\n      cancelText: '取消',\n      success: async (res) => {\n        if (res.confirm) {\n          await this._handleLogoutRequest(redirectCb);\n        }\n      }\n    });\n  },\n\n  async _handleLogoutRequest(redirectCb) {\n    try {\n      // 2. 获取本地Token\n      const token = uni.getStorageSync('autoToken') || uni.getStorageSync('token');\n      if (!token) {\n        console.warn('logoutUtil: 本地无有效Token，直接清除状态');\n        this._clearLoginState(redirectCb);\n        return;\n      }\n\n      const res = await post(\n        'https://jxpj.neau.edu.cn/api/v1/logout',\n        {},\n        { headers: { 'Authorization': `Bearer ${token}` } }\n      );\n\n      // 处理接口响应\n      if (res?.code === 200) {\n        console.log('logoutUtil: 后端退出成功');\n        uni.showToast({ title: '已退出登录', icon: 'none', duration: 1500 });\n        this._clearLoginState(redirectCb);\n      } else {\n        console.error('logoutUtil: 后端退出失败', res);\n        uni.showToast({ title: '退出失败，请重试', icon: 'none' });\n      }\n    } catch (err) {\n      console.error('logoutUtil: 退出请求异常', err);\n      uni.showToast({ title: '网络异常，已强制退出', icon: 'none' });\n      this._clearLoginState(redirectCb);\n    }\n  },\n\n  _clearLoginState(redirectCb) {\n    try {\n      uni.removeStorageSync('autoToken');\n      uni.removeStorageSync('token');\n      uni.removeStorageSync('userInfo');\n      uni.removeStorageSync('isLogin');\r\n\t    uni.removeStorageSync('userID');\n    } catch (err) {\n      console.error('logoutUtil: 清除状态失败', err);\n    }\n    if (typeof redirectCb === 'function') {\n      redirectCb();\n    } else {\n      setTimeout(() => uni.redirectTo({ url: '/pages/login/login' }), 3000);\n    }\n  }\n};"],"names":["uni","post"],"mappings":";;;AAEY,MAAC,aAAa;AAAA,EACxB,MAAM,SAAS,YAAY;AACzBA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,aAAa;AAAA,MACb,YAAY;AAAA,MACZ,SAAS,OAAO,QAAQ;AACtB,YAAI,IAAI,SAAS;AACf,gBAAM,KAAK,qBAAqB,UAAU;AAAA,QAC3C;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACF;AAAA,EAED,MAAM,qBAAqB,YAAY;AACrC,QAAI;AAEF,YAAM,QAAQA,cAAG,MAAC,eAAe,WAAW,KAAKA,oBAAI,eAAe,OAAO;AAC3E,UAAI,CAAC,OAAO;AACVA,sBAAAA,MAAa,MAAA,QAAA,0CAAA,+BAA+B;AAC5C,aAAK,iBAAiB,UAAU;AAChC;AAAA,MACD;AAED,YAAM,MAAM,MAAMC,sBAAI;AAAA,QACpB;AAAA,QACA,CAAE;AAAA,QACF,EAAE,SAAS,EAAE,iBAAiB,UAAU,KAAK,KAAM;AAAA,MAC3D;AAGM,WAAI,2BAAK,UAAS,KAAK;AACrBD,sBAAAA,MAAA,MAAA,OAAA,0CAAY,oBAAoB;AAChCA,4BAAI,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ,UAAU,KAAI,CAAE;AAC9D,aAAK,iBAAiB,UAAU;AAAA,MACxC,OAAa;AACLA,sBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AACvCA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,OAAM,CAAE;AAAA,MAClD;AAAA,IACF,SAAQ,KAAK;AACZA,oBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AACvCA,oBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,OAAM,CAAE;AACnD,WAAK,iBAAiB,UAAU;AAAA,IACjC;AAAA,EACF;AAAA,EAED,iBAAiB,YAAY;AAC3B,QAAI;AACFA,0BAAI,kBAAkB,WAAW;AACjCA,0BAAI,kBAAkB,OAAO;AAC7BA,0BAAI,kBAAkB,UAAU;AAChCA,0BAAI,kBAAkB,SAAS;AAChCA,0BAAI,kBAAkB,QAAQ;AAAA,IAC9B,SAAQ,KAAK;AACZA,oBAAc,MAAA,MAAA,SAAA,0CAAA,sBAAsB,GAAG;AAAA,IACxC;AACD,QAAI,OAAO,eAAe,YAAY;AACpC;IACN,OAAW;AACL,iBAAW,MAAMA,cAAG,MAAC,WAAW,EAAE,KAAK,qBAAsB,CAAA,GAAG,GAAI;AAAA,IACrE;AAAA,EACF;AACH;;"}