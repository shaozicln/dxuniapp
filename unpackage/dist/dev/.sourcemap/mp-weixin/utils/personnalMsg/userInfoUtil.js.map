{"version":3,"file":"userInfoUtil.js","sources":["utils/personnalMsg/userInfoUtil.js"],"sourcesContent":["export const userInfoUtil = {\n  initFromStorage(reactiveUserInfo) {\n    try {\n      const storedUserInfo = uni.getStorageSync('userInfo') || {};\n      Object.keys(reactiveUserInfo).forEach(key => {\n        if (storedUserInfo[key] !== undefined && storedUserInfo[key] !== '') {\n          reactiveUserInfo[key] = storedUserInfo[key];\n        }\n      });\n      let identity = '未登录';\n      if (typeof storedUserInfo.userIdentity === 'string' && storedUserInfo.userIdentity) {\n        identity = storedUserInfo.userIdentity;\n      } \n      // 兼容逻辑：若没有 userIdentity，按 ID 类型推断\n      else if (storedUserInfo.teacherID?.startsWith('Z')) {\n        identity = '教师';\n      } else if (storedUserInfo.studentID) {\n        identity = '学生';\n      }\n      reactiveUserInfo.identity = identity;\n      return reactiveUserInfo;\n    } catch (err) {\n      console.error('userInfoUtil: 初始化用户信息失败', err);\n      uni.showToast({ title: '信息加载失败', icon: 'none' });\n      return reactiveUserInfo;\n    }\n  },\n\n  generateInfoList(userInfo) {\n    let baseItems = [\n      { label: '姓名', value: userInfo.name, canEdit: false },\n      { label: '身份', value: userInfo.identity, canEdit: false }, // 此处使用 identity（已修正）\n      { label: '性别', value: userInfo.gender, canEdit: true },\n      { label: '学院', value: userInfo.college, canEdit: true },\n      { \n        label: this.getIDLabel(userInfo.identity), \n        value: userInfo.teacherID || userInfo.studentID || '未设置', \n        canEdit: false \n      }\n    ];\n    // 学生额外显示班级、专业\n    if (userInfo.identity === '学生') {\n      baseItems.splice(4, 0, \n        { label: '班级', value: userInfo.className, canEdit: true },\n        { label: '专业', value: userInfo.major, canEdit: true }\n      );\n    }\n    if (['领导', '督导'].includes(userInfo.identity)) {\n      baseItems.push({ label: '部门', value: userInfo.department || '未设置', canEdit: true });\n    }\n    return baseItems;\n  },\n\n  getIDLabel(identity) {\n    const labels = {\n      '教师': '教工号',\n      '学生': '学号',\n      '领导': '教工号',\n      '督导': '教工号'\n    };\n    return labels[identity] || '编号';\n  },\n\n  getEditableFields(identity) {\n    const baseFields = [\n      { label: '性别', field: 'gender', type: 'select', options: ['男', '女', '保密'] },\n      { label: '学院', field: 'college', type: 'input', placeholder: '请输入学院名称' }\n    ];\n    if (identity === '学生') {\n      return [\n        ...baseFields,\n        { label: '班级', field: 'className', type: 'input', placeholder: '请输入班级（如计科2301）' },\n        { label: '专业', field: 'major', type: 'input', placeholder: '请输入专业名称' }\n      ];\n    }\n    return baseFields;\n  }\n};"],"names":["uni"],"mappings":";;AAAY,MAAC,eAAe;AAAA,EAC1B,gBAAgB,kBAAkB;;AAChC,QAAI;AACF,YAAM,iBAAiBA,cAAG,MAAC,eAAe,UAAU,KAAK,CAAA;AACzD,aAAO,KAAK,gBAAgB,EAAE,QAAQ,SAAO;AAC3C,YAAI,eAAe,GAAG,MAAM,UAAa,eAAe,GAAG,MAAM,IAAI;AACnE,2BAAiB,GAAG,IAAI,eAAe,GAAG;AAAA,QAC3C;AAAA,MACT,CAAO;AACD,UAAI,WAAW;AACf,UAAI,OAAO,eAAe,iBAAiB,YAAY,eAAe,cAAc;AAClF,mBAAW,eAAe;AAAA,MAC3B,YAEQ,oBAAe,cAAf,mBAA0B,WAAW,MAAM;AAClD,mBAAW;AAAA,MACnB,WAAiB,eAAe,WAAW;AACnC,mBAAW;AAAA,MACZ;AACD,uBAAiB,WAAW;AAC5B,aAAO;AAAA,IACR,SAAQ,KAAK;AACZA,qFAAc,2BAA2B,GAAG;AAC5CA,oBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAM,CAAE;AAC/C,aAAO;AAAA,IACR;AAAA,EACF;AAAA,EAED,iBAAiB,UAAU;AACzB,QAAI,YAAY;AAAA,MACd,EAAE,OAAO,MAAM,OAAO,SAAS,MAAM,SAAS,MAAO;AAAA,MACrD,EAAE,OAAO,MAAM,OAAO,SAAS,UAAU,SAAS,MAAO;AAAA;AAAA,MACzD,EAAE,OAAO,MAAM,OAAO,SAAS,QAAQ,SAAS,KAAM;AAAA,MACtD,EAAE,OAAO,MAAM,OAAO,SAAS,SAAS,SAAS,KAAM;AAAA,MACvD;AAAA,QACE,OAAO,KAAK,WAAW,SAAS,QAAQ;AAAA,QACxC,OAAO,SAAS,aAAa,SAAS,aAAa;AAAA,QACnD,SAAS;AAAA,MACV;AAAA,IACP;AAEI,QAAI,SAAS,aAAa,MAAM;AAC9B,gBAAU;AAAA,QAAO;AAAA,QAAG;AAAA,QAClB,EAAE,OAAO,MAAM,OAAO,SAAS,WAAW,SAAS,KAAM;AAAA,QACzD,EAAE,OAAO,MAAM,OAAO,SAAS,OAAO,SAAS,KAAM;AAAA,MAC7D;AAAA,IACK;AACD,QAAI,CAAC,MAAM,IAAI,EAAE,SAAS,SAAS,QAAQ,GAAG;AAC5C,gBAAU,KAAK,EAAE,OAAO,MAAM,OAAO,SAAS,cAAc,OAAO,SAAS,KAAM,CAAA;AAAA,IACnF;AACD,WAAO;AAAA,EACR;AAAA,EAED,WAAW,UAAU;AACnB,UAAM,SAAS;AAAA,MACb,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,IACZ;AACI,WAAO,OAAO,QAAQ,KAAK;AAAA,EAC5B;AAAA,EAED,kBAAkB,UAAU;AAC1B,UAAM,aAAa;AAAA,MACjB,EAAE,OAAO,MAAM,OAAO,UAAU,MAAM,UAAU,SAAS,CAAC,KAAK,KAAK,IAAI,EAAG;AAAA,MAC3E,EAAE,OAAO,MAAM,OAAO,WAAW,MAAM,SAAS,aAAa,UAAW;AAAA,IAC9E;AACI,QAAI,aAAa,MAAM;AACrB,aAAO;AAAA,QACL,GAAG;AAAA,QACH,EAAE,OAAO,MAAM,OAAO,aAAa,MAAM,SAAS,aAAa,iBAAkB;AAAA,QACjF,EAAE,OAAO,MAAM,OAAO,SAAS,MAAM,SAAS,aAAa,UAAW;AAAA,MAC9E;AAAA,IACK;AACD,WAAO;AAAA,EACR;AACH;;"}