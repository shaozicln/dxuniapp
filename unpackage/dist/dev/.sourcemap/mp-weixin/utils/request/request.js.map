{"version":3,"file":"request.js","sources":["utils/request/request.js"],"sourcesContent":["import {\r\n\tgetCurrentInstance\r\n} from 'vue';\r\n\r\nexport const getBaseURL = () => {\r\n  const instance = getCurrentInstance();\r\n  let baseUrl = instance?.appContext?.config?.globalProperties?.$URL || 'http://localhost:8080';\r\n  return baseUrl.replace(/\\/$/, '');\r\n};\r\n\r\n\r\nexport const request = (options) => {\r\n\t// 1. 获取基础URL并拼接完整路径\r\n\tconst baseURL = getBaseURL();\r\n\tlet fullUrl = options.url;\r\n\r\n\tif (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {\r\n\t\tconst path = fullUrl.replace(/^\\/+/, ''); // 移除路径开头的斜杠\r\n\t\tfullUrl = `${baseURL}/${path}`;\r\n\t}\r\n\r\n\t// 2. 自动获取本地存储的Token\r\n\tconst token = uni.getStorageSync('token') || '';\r\n\r\n\t// 3. 构建请求头（自动携带Token）\r\n\tconst defaultHeaders = {\r\n\t\t'Accept': '*/*',\r\n\t\t'Connection': 'keep-alive',\r\n\t\t...(token && {\r\n\t\t\t'Authorization': token\r\n\t\t}), // 有Token时才添加\r\n\t\t...options.headers // 允许用户传入自定义头（可覆盖默认值）\r\n\t};\r\n\r\n\tconsole.log('请求URL:', fullUrl);\r\n\tconsole.log('请求头:', defaultHeaders);\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.request({\r\n\t\t\t...options,\r\n\t\t\turl: fullUrl,\r\n\t\t\theader: defaultHeaders, // 注意uni-app中是header而非headers\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// 统一处理401 Token失效\r\n\t\t\t\tif (res.statusCode === 401) {\r\n\t\t\t\t\tuni.removeStorageSync('token');\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录已过期，请重新登录',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treject(new Error('Token失效'));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tresolve(res.data);\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\treject(new Error(`请求失败: ${err.errMsg}`));\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n};\r\n\r\n// 快捷请求方法\r\nexport const get = (url, data = {}, options = {}) => {\r\n\treturn request({\r\n\t\t...options,\r\n\t\turl,\r\n\t\tdata,\r\n\t\tmethod: 'GET'\r\n\t});\r\n};\r\n\r\nexport const post = (url, data = {}, options = {}) => {\r\n\treturn request({\r\n\t\t...options,\r\n\t\turl,\r\n\t\tdata,\r\n\t\tmethod: 'POST'\r\n\t});\r\n};\r\n\r\nexport const put = (url, data = {}, options = {}) => {\r\n\treturn request({\r\n\t\t...options,\r\n\t\turl,\r\n\t\tdata,\r\n\t\tmethod: 'PUT'\r\n\t});\r\n};\r\n\r\nexport const del = (url, data = {}, options = {}) => {\r\n\treturn request({\r\n\t\t...options,\r\n\t\turl,\r\n\t\tdata,\r\n\t\tmethod: 'DELETE'\r\n\t});\r\n};"],"names":["getCurrentInstance","uni"],"mappings":";;AAIO,MAAM,aAAa,MAAM;;AAC9B,QAAM,WAAWA,cAAAA;AACjB,MAAI,YAAU,sDAAU,eAAV,mBAAsB,WAAtB,mBAA8B,qBAA9B,mBAAgD,SAAQ;AACtE,SAAO,QAAQ,QAAQ,OAAO,EAAE;AAClC;AAGY,MAAC,UAAU,CAAC,YAAY;AAEnC,QAAM,UAAU;AAChB,MAAI,UAAU,QAAQ;AAEtB,MAAI,CAAC,QAAQ,WAAW,SAAS,KAAK,CAAC,QAAQ,WAAW,UAAU,GAAG;AACtE,UAAM,OAAO,QAAQ,QAAQ,QAAQ,EAAE;AACvC,cAAU,GAAG,OAAO,IAAI,IAAI;AAAA,EAC5B;AAGD,QAAM,QAAQC,cAAG,MAAC,eAAe,OAAO,KAAK;AAG7C,QAAM,iBAAiB;AAAA,IACtB,UAAU;AAAA,IACV,cAAc;AAAA,IACd,GAAI,SAAS;AAAA,MACZ,iBAAiB;AAAA,IACjB;AAAA;AAAA,IACD,GAAG,QAAQ;AAAA;AAAA,EACb;AAECA,gBAAA,MAAA,MAAA,OAAA,kCAAY,UAAU,OAAO;AAC7BA,gBAAA,MAAA,MAAA,OAAA,kCAAY,QAAQ,cAAc;AAElC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,QAAQ;AAAA,MACX,GAAG;AAAA,MACH,KAAK;AAAA,MACL,QAAQ;AAAA;AAAA,MACR,SAAS,CAAC,QAAQ;AAEjB,YAAI,IAAI,eAAe,KAAK;AAC3BA,8BAAI,kBAAkB,OAAO;AAC7BA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACZ,CAAM;AACD,iBAAO,IAAI,MAAM,SAAS,CAAC;AAC3B;AAAA,QACA;AACD,gBAAQ,IAAI,IAAI;AAAA,MAChB;AAAA,MACD,MAAM,CAAC,QAAQ;AACd,eAAO,IAAI,MAAM,SAAS,IAAI,MAAM,EAAE,CAAC;AAAA,MACvC;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAGY,MAAC,MAAM,CAAC,KAAK,OAAO,CAAA,GAAI,UAAU,CAAA,MAAO;AACpD,SAAO,QAAQ;AAAA,IACd,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,EACV,CAAE;AACF;AAEY,MAAC,OAAO,CAAC,KAAK,OAAO,CAAA,GAAI,UAAU,CAAA,MAAO;AACrD,SAAO,QAAQ;AAAA,IACd,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,EACV,CAAE;AACF;AAEY,MAAC,MAAM,CAAC,KAAK,OAAO,CAAA,GAAI,UAAU,CAAA,MAAO;AACpD,SAAO,QAAQ;AAAA,IACd,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,EACV,CAAE;AACF;AAEY,MAAC,MAAM,CAAC,KAAK,OAAO,CAAA,GAAI,UAAU,CAAA,MAAO;AACpD,SAAO,QAAQ;AAAA,IACd,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA,QAAQ;AAAA,EACV,CAAE;AACF;;;;;;"}